<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 Accessing Data | R Without Statistics</title>
<meta name="author" content="David Keyes">
<meta name="description" content="So far, we’ve imported data into projects from CSV files. Many online datasets allow you to export data as a CSV, but before you do so, you should look for packages to automate your data access....">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 11 Accessing Data | R Without Statistics">
<meta property="og:type" content="book">
<meta property="og:url" content="https://book.rwithoutstatistics.com/accessing-data-chapter.html">
<meta property="og:image" content="https://book.rwithoutstatistics.com/mock-cover.png">
<meta property="og:description" content="So far, we’ve imported data into projects from CSV files. Many online datasets allow you to export data as a CSV, but before you do so, you should look for packages to automate your data access....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 Accessing Data | R Without Statistics">
<meta name="twitter:description" content="So far, we’ve imported data into projects from CSV files. Many online datasets allow you to export data as a CSV, but before you do so, you should look for packages to automate your data access....">
<meta name="twitter:image" content="https://book.rwithoutstatistics.com/mock-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Without Statistics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About the Book</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="introduction.html">Introduction</a></li>
<li><a class="" href="howto-chapter.html"><span class="header-section-number">1</span> An R Programming Crash Course</a></li>
<li class="book-part">Part 1: Visualizations</li>
<li><a class="" href="data-viz-chapter.html"><span class="header-section-number">2</span> Principles of Data Visualization</a></li>
<li><a class="" href="custom-theme-chapter.html"><span class="header-section-number">3</span> Making Your Own Theme</a></li>
<li><a class="" href="maps-chapter.html"><span class="header-section-number">4</span> Creating Maps</a></li>
<li><a class="" href="tables-chapter.html"><span class="header-section-number">5</span> Crafting High-Quality Tables</a></li>
<li class="book-part">Part 2: Reports, Presentations, and Websites</li>
<li><a class="" href="rmarkdown-chapter.html"><span class="header-section-number">6</span> Writing Reports in R Markdown</a></li>
<li><a class="" href="parameterized-reports-chapter.html"><span class="header-section-number">7</span> Using Parameters to Automate Reports</a></li>
<li><a class="" href="presentations-chapter.html"><span class="header-section-number">8</span> Making Slides Presentations with xaringan</a></li>
<li><a class="" href="websites-chapter.html"><span class="header-section-number">9</span> Make Websites to Share Results Online</a></li>
<li><a class="" href="quarto-chapter.html"><span class="header-section-number">10</span> Reproducible Reporting with Quarto</a></li>
<li class="book-part">Part 3: Automation and Collaboration</li>
<li><a class="active" href="accessing-data-chapter.html"><span class="header-section-number">11</span> Accessing Data</a></li>
<li><a class="" href="packages-chapter.html"><span class="header-section-number">12</span> Creating Your Own R Packages</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rfortherestofus/r-without-statistics">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="accessing-data-chapter" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Accessing Data<a class="anchor" aria-label="anchor" href="#accessing-data-chapter"><i class="fas fa-link"></i></a>
</h1>
<p>So far, we’ve imported data into projects from CSV files. Many online datasets allow you to export data as a CSV, but before you do so, you should look for packages to automate your data access. If you can eliminate the manual steps involved in fetching data, your analysis and reporting will be more accurate. You’ll also be able to efficiently update your report when the data changes.</p>
<p>R offers many ways to automate the process of accessing online data. In this chapter, I’ll discuss two such approaches: using the <code>googlesheets4</code> package to fetch data directly from Google Sheets and using the <code>tidycensus</code> package to access data from the United States Census Bureau. You’ll learn how to connect your R Markdown project to Google so you can automatically download data when a Google Sheet updates. Then you’ll explore working with two large census datasets, the Decennial Census and the American Community Survey, and practice visualizing them.</p>
<div id="importing-data-from-google-sheets-with-googlesheets4" class="section level2 unnumbered">
<h2>Importing Data from Google Sheets with <code>googlesheets4</code><a class="anchor" aria-label="anchor" href="#importing-data-from-google-sheets-with-googlesheets4"><i class="fas fa-link"></i></a>
</h2>
<p>By using the <code>googlesheets4</code> package to access data directly from Google Sheets, you can avoid having to manually download data, copy it into your project, and adjust your code so it imports that new data each time you want to update a report. This package lets you write code that automatically fetches new data directly from Google Sheets. Whenever you need to update your report, you can simply run your code to refresh the data. In addition, if you work with Google Forms, you can pipe your data into Google Sheets, completely automating the workflow from data collection to data import.</p>
<p>Using this package can help you manage complex datasets that update frequently. For example, in her role at the Primary Care Research Institute at the University of Buffalo, Megan Harris used it for a research project about people affected by opioid use disorder. The data came from a variety of surveys, all of which fed into a jumble of Google Sheets. Using <code>googlesheets4</code>, she was able to bring all of her data into one place and use R to put them to use. Data that had once been largely unused because accessing it was so complicated came to inform research on opioid use disorder.</p>
<p>This section demonstrates how the <code>googlesheets4</code> package works using a fake dataset about video game preferences that Harris created to replace her opioid survey data (which, for obvious reasons, is confidential).</p>
<div id="connecting-to-google" class="section level3 unnumbered">
<h3>Connecting to Google<a class="anchor" aria-label="anchor" href="#connecting-to-google"><i class="fas fa-link"></i></a>
</h3>
<p>Begin by installing the <code>googlesheets4</code> package by running <code>install.packages("googlesheets4")</code>. Next, you’ll need to connect to your Google account. To do this, run the <code><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth.html">gs4_auth()</a></code> function in the console. If you have more than one Google account, select the account that has access to the Google Sheet you want to work with. Once you do so, you should see a screen that looks like Figure <a href="accessing-data-chapter.html#fig:tidyverse-access-r">11.1</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:tidyverse-access-r"></span>
<img src="assets/tidyverse-access-r.png" alt="The screen asking for authorization to access your Google Sheets data" width="100%"><p class="caption">
Figure 11.1: The screen asking for authorization to access your Google Sheets data
</p>
</div>
<p>Check the box next to <strong>See, edit, create, and delete all your Google Sheets spreadsheets</strong>. This will ensure that R is able to access data from your Google Sheets account. Hit <strong>Continue</strong>, and you’ll be given the message <em>Authentication complete. Please close this page and return to R</em>. The <code>googlesheets4</code> package will now save your credentials so that you can use them in the future without having to reauthenticate.</p>
</div>
<div id="reading-data-from-a-sheet" class="section level3 unnumbered">
<h3>Reading Data from a Sheet<a class="anchor" aria-label="anchor" href="#reading-data-from-a-sheet"><i class="fas fa-link"></i></a>
</h3>
<p>Now that we’ve connected R to our Google account, we can import data. We’ll import the fake data that Meghan Harris created about video game preferences (you can access it at <a href="https://data.rwithoutstatistics.com/google-sheet" class="uri">https://data.rwithoutstatistics.com/google-sheet</a>). Figure <a href="accessing-data-chapter.html#fig:video-game-survey-data">11.2</a> shows what it looks like in Google Sheets.</p>
<div class="figure">
<span style="display:block;" id="fig:video-game-survey-data"></span>
<img src="assets/video-game-survey-data.png" alt="The video game data in Google Sheets" width="100%"><p class="caption">
Figure 11.2: The video game data in Google Sheets
</p>
</div>
<p>The <code>googlesheets4</code> package has a function called <code><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet()</a></code> that allows you to pull in data directly from a Google Sheet. Import the data by passing the spreadsheet’s URL to the function:</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org">googlesheets4</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">survey_data_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="st">"https://docs.google.com/spreadsheets/d/1AR0_RcFBg8wdiY4Cj-k8vRypp_txh27MyZuiRdqScog/edit?usp=sharing"</span><span class="op">)</span></span></code></pre></div>
<p>Take a look at the <code>survey_data_raw</code> object to confirm that the data was imported. Using the <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function from the <code>dplyr</code> package can make it easier to read:</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">survey_data_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function, which creates one output row per variable, shows that we’ve indeed imported the data directly from Google Sheets:</p>
<pre><code>#&gt; Rows: 5
#&gt; Columns: 5
#&gt; $ Timestamp                         &lt;dttm&gt; 2022-05-16 15:2…
#&gt; $ `How old are you?`                &lt;chr&gt; "25-34", "45-54"…
#&gt; $ `Do you like to play video games` &lt;chr&gt; "Yes", "No", "Ye…
#&gt; $ `What kind of games do you like?` &lt;chr&gt; "Sandbox, Role-P…
#&gt; $ `What's your favorite game?`      &lt;chr&gt; "It's hard to ch…</code></pre>
<p>Once we have the data in R, we can use the same workflow we always do when creating reports with R Markdown.</p>
</div>
<div id="using-the-data-in-r-markdown" class="section level3 unnumbered">
<h3>Using the Data in R Markdown<a class="anchor" aria-label="anchor" href="#using-the-data-in-r-markdown"><i class="fas fa-link"></i></a>
</h3>
<p>The following code is taken from an R Markdown report that Meghan Harris made to summarize the video games data. You can see the YAML, the <code>setup</code> code chunk, a code chunk that loads packages, and the code to import data from Google Sheets:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb199-1"><a href="accessing-data-chapter.html#cb199-1" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb199-2"><a href="accessing-data-chapter.html#cb199-2" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Video Game Survey"</span></span>
<span id="cb199-3"><a href="accessing-data-chapter.html#cb199-3" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb199-4"><a href="accessing-data-chapter.html#cb199-4" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb199-5"><a href="accessing-data-chapter.html#cb199-5" tabindex="-1"></a></span>
<span id="cb199-6"><a href="accessing-data-chapter.html#cb199-6" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb199-7"><a href="accessing-data-chapter.html#cb199-7" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = FALSE,</span></span>
<span id="cb199-8"><a href="accessing-data-chapter.html#cb199-8" tabindex="-1"></a><span class="in">                      warning = FALSE,</span></span>
<span id="cb199-9"><a href="accessing-data-chapter.html#cb199-9" tabindex="-1"></a><span class="in">                      message = FALSE)</span></span>
<span id="cb199-10"><a href="accessing-data-chapter.html#cb199-10" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb199-11"><a href="accessing-data-chapter.html#cb199-11" tabindex="-1"></a></span>
<span id="cb199-12"><a href="accessing-data-chapter.html#cb199-12" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb199-13"><a href="accessing-data-chapter.html#cb199-13" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb199-14"><a href="accessing-data-chapter.html#cb199-14" tabindex="-1"></a><span class="in">library(janitor)</span></span>
<span id="cb199-15"><a href="accessing-data-chapter.html#cb199-15" tabindex="-1"></a><span class="in">library(googlesheets4)</span></span>
<span id="cb199-16"><a href="accessing-data-chapter.html#cb199-16" tabindex="-1"></a><span class="in">library(gt)</span></span>
<span id="cb199-17"><a href="accessing-data-chapter.html#cb199-17" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb199-18"><a href="accessing-data-chapter.html#cb199-18" tabindex="-1"></a></span>
<span id="cb199-19"><a href="accessing-data-chapter.html#cb199-19" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb199-20"><a href="accessing-data-chapter.html#cb199-20" tabindex="-1"></a><span class="in"># Import data from Google Sheets</span></span>
<span id="cb199-21"><a href="accessing-data-chapter.html#cb199-21" tabindex="-1"></a><span class="in">survey_data_raw &lt;- read_sheet("https://docs.google.com/spreadsheets/d/1AR0_RcFBg8wdiY4Cj-k8vRypp_txh27MyZuiRdqScog/edit?usp=sharing")</span></span>
<span id="cb199-22"><a href="accessing-data-chapter.html#cb199-22" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>The R Markdown document resembles those discussed in previous chapters except for the way we’re importing the data. Because we’re bringing it in directly from Google Sheets, there’s no risk of, say, accidentally reading in the wrong CSV. Automating this step reduces the risk of error.</p>
<p>The next code chunk cleans the <code>survey_data_raw</code> object, saving the result as <code>survey_data_clean</code>:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb200-1"><a href="accessing-data-chapter.html#cb200-1" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb200-2"><a href="accessing-data-chapter.html#cb200-2" tabindex="-1"></a><span class="in"># Clean data</span></span>
<span id="cb200-3"><a href="accessing-data-chapter.html#cb200-3" tabindex="-1"></a><span class="in">survey_data_clean &lt;- survey_data_raw %&gt;%</span></span>
<span id="cb200-4"><a href="accessing-data-chapter.html#cb200-4" tabindex="-1"></a><span class="in">  clean_names() %&gt;%</span></span>
<span id="cb200-5"><a href="accessing-data-chapter.html#cb200-5" tabindex="-1"></a><span class="in">  mutate(participant_id = as.character(row_number())) %&gt;%</span></span>
<span id="cb200-6"><a href="accessing-data-chapter.html#cb200-6" tabindex="-1"></a><span class="in">  rename(age = how_old_are_you,</span></span>
<span id="cb200-7"><a href="accessing-data-chapter.html#cb200-7" tabindex="-1"></a><span class="in">         like_games = do_you_like_to_play_video_games,</span></span>
<span id="cb200-8"><a href="accessing-data-chapter.html#cb200-8" tabindex="-1"></a><span class="in">         game_types = what_kind_of_games_do_you_like,</span></span>
<span id="cb200-9"><a href="accessing-data-chapter.html#cb200-9" tabindex="-1"></a><span class="in">         favorite_game = whats_your_favorite_game) %&gt;%</span></span>
<span id="cb200-10"><a href="accessing-data-chapter.html#cb200-10" tabindex="-1"></a><span class="in">  relocate(participant_id, .before = age) %&gt;%</span></span>
<span id="cb200-11"><a href="accessing-data-chapter.html#cb200-11" tabindex="-1"></a><span class="in">  mutate(age = factor(age, levels = c("Under 18", "18-24", "25-34", "35-44", "45-54", "55-64", "Over 65")))</span></span>
<span id="cb200-12"><a href="accessing-data-chapter.html#cb200-12" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>Here, we use the <code>clean_names()</code> function from the <code>janitor</code> package to make the variable names easier to work with. We then add a <code>participant_id</code> variable using the <code><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number()</a></code> function, which adds a consecutively increasing number to each row. (I also make it a character using the <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> function.) Next, I change several variable names with <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> before finally using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to make the <code>age</code> variable into a data structure known as a <em>factor</em>; doing so will make sure the <code>age</code> variable shows up in the right order in our charts. I then use <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> to put <code>participant_id</code> before the <code>age</code> variable. We can now take a look at our <code>survey_data_clean</code> data frame using the <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function again:</p>
<pre><code>#&gt; Rows: 5
#&gt; Columns: 6
#&gt; $ timestamp      &lt;dttm&gt; 2022-05-16 15:20:50, 2022-05-16 15…
#&gt; $ participant_id &lt;chr&gt; "1", "2", "3", "4", "5"
#&gt; $ age            &lt;fct&gt; 25-34, 45-54, Under 18, Over 65, Un…
#&gt; $ like_games     &lt;chr&gt; "Yes", "No", "Yes", "No", "Yes"
#&gt; $ game_types     &lt;chr&gt; "Sandbox, Role-Playing (RPG), Simul…
#&gt; $ favorite_game  &lt;chr&gt; "It's hard to choose. House Flipper…</code></pre>
<p>The rest of the report uses this data to highlight a variety of statistics:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb202-1"><a href="accessing-data-chapter.html#cb202-1" tabindex="-1"></a><span class="fu"># Respondent Demographics</span></span>
<span id="cb202-2"><a href="accessing-data-chapter.html#cb202-2" tabindex="-1"></a></span>
<span id="cb202-3"><a href="accessing-data-chapter.html#cb202-3" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb202-4"><a href="accessing-data-chapter.html#cb202-4" tabindex="-1"></a><span class="in"># Calculate number of respondents</span></span>
<span id="cb202-5"><a href="accessing-data-chapter.html#cb202-5" tabindex="-1"></a><span class="in">number_of_respondents &lt;- nrow(survey_data_clean)</span></span>
<span id="cb202-6"><a href="accessing-data-chapter.html#cb202-6" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb202-7"><a href="accessing-data-chapter.html#cb202-7" tabindex="-1"></a></span>
<span id="cb202-8"><a href="accessing-data-chapter.html#cb202-8" tabindex="-1"></a>We received responses from <span class="in">`r number_of_respondents`</span> respondents. Their ages are below.</span>
<span id="cb202-9"><a href="accessing-data-chapter.html#cb202-9" tabindex="-1"></a></span>
<span id="cb202-10"><a href="accessing-data-chapter.html#cb202-10" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb202-11"><a href="accessing-data-chapter.html#cb202-11" tabindex="-1"></a><span class="in">survey_data_clean %&gt;% </span></span>
<span id="cb202-12"><a href="accessing-data-chapter.html#cb202-12" tabindex="-1"></a><span class="in">  select(participant_id, age) %&gt;% </span></span>
<span id="cb202-13"><a href="accessing-data-chapter.html#cb202-13" tabindex="-1"></a><span class="in">  gt() %&gt;% </span></span>
<span id="cb202-14"><a href="accessing-data-chapter.html#cb202-14" tabindex="-1"></a><span class="in">  cols_label(</span></span>
<span id="cb202-15"><a href="accessing-data-chapter.html#cb202-15" tabindex="-1"></a><span class="in">    participant_id = "Participant ID",</span></span>
<span id="cb202-16"><a href="accessing-data-chapter.html#cb202-16" tabindex="-1"></a><span class="in">    age = "Age"</span></span>
<span id="cb202-17"><a href="accessing-data-chapter.html#cb202-17" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb202-18"><a href="accessing-data-chapter.html#cb202-18" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb202-19"><a href="accessing-data-chapter.html#cb202-19" tabindex="-1"></a><span class="in">    style = cell_text(weight = "bold"),</span></span>
<span id="cb202-20"><a href="accessing-data-chapter.html#cb202-20" tabindex="-1"></a><span class="in">    locations = cells_column_labels()</span></span>
<span id="cb202-21"><a href="accessing-data-chapter.html#cb202-21" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb202-22"><a href="accessing-data-chapter.html#cb202-22" tabindex="-1"></a><span class="in">  cols_align(</span></span>
<span id="cb202-23"><a href="accessing-data-chapter.html#cb202-23" tabindex="-1"></a><span class="in">    align = "left",</span></span>
<span id="cb202-24"><a href="accessing-data-chapter.html#cb202-24" tabindex="-1"></a><span class="in">    columns = everything()</span></span>
<span id="cb202-25"><a href="accessing-data-chapter.html#cb202-25" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb202-26"><a href="accessing-data-chapter.html#cb202-26" tabindex="-1"></a><span class="in">  cols_width(</span></span>
<span id="cb202-27"><a href="accessing-data-chapter.html#cb202-27" tabindex="-1"></a><span class="in">    participant_id ~ px(200),</span></span>
<span id="cb202-28"><a href="accessing-data-chapter.html#cb202-28" tabindex="-1"></a><span class="in">    age ~ px(700)</span></span>
<span id="cb202-29"><a href="accessing-data-chapter.html#cb202-29" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb202-30"><a href="accessing-data-chapter.html#cb202-30" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb202-31"><a href="accessing-data-chapter.html#cb202-31" tabindex="-1"></a></span>
<span id="cb202-32"><a href="accessing-data-chapter.html#cb202-32" tabindex="-1"></a><span class="fu"># Video Games</span></span>
<span id="cb202-33"><a href="accessing-data-chapter.html#cb202-33" tabindex="-1"></a></span>
<span id="cb202-34"><a href="accessing-data-chapter.html#cb202-34" tabindex="-1"></a>We asked if respondents liked video games. Their responses are below.</span>
<span id="cb202-35"><a href="accessing-data-chapter.html#cb202-35" tabindex="-1"></a></span>
<span id="cb202-36"><a href="accessing-data-chapter.html#cb202-36" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb202-37"><a href="accessing-data-chapter.html#cb202-37" tabindex="-1"></a><span class="in">survey_data_clean %&gt;%</span></span>
<span id="cb202-38"><a href="accessing-data-chapter.html#cb202-38" tabindex="-1"></a><span class="in">  count(like_games) %&gt;% </span></span>
<span id="cb202-39"><a href="accessing-data-chapter.html#cb202-39" tabindex="-1"></a><span class="in">  ggplot(aes(x = like_games,</span></span>
<span id="cb202-40"><a href="accessing-data-chapter.html#cb202-40" tabindex="-1"></a><span class="in">             y = n,</span></span>
<span id="cb202-41"><a href="accessing-data-chapter.html#cb202-41" tabindex="-1"></a><span class="in">             fill = like_games)) +</span></span>
<span id="cb202-42"><a href="accessing-data-chapter.html#cb202-42" tabindex="-1"></a><span class="in">  geom_col() +</span></span>
<span id="cb202-43"><a href="accessing-data-chapter.html#cb202-43" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c(</span></span>
<span id="cb202-44"><a href="accessing-data-chapter.html#cb202-44" tabindex="-1"></a><span class="in">    "No" = "#6cabdd",</span></span>
<span id="cb202-45"><a href="accessing-data-chapter.html#cb202-45" tabindex="-1"></a><span class="in">    "Yes" = "#ff7400"</span></span>
<span id="cb202-46"><a href="accessing-data-chapter.html#cb202-46" tabindex="-1"></a><span class="in">  )) +</span></span>
<span id="cb202-47"><a href="accessing-data-chapter.html#cb202-47" tabindex="-1"></a><span class="in">  labs(title = "How Many People Like Video Games?", </span></span>
<span id="cb202-48"><a href="accessing-data-chapter.html#cb202-48" tabindex="-1"></a><span class="in">       x = NULL,</span></span>
<span id="cb202-49"><a href="accessing-data-chapter.html#cb202-49" tabindex="-1"></a><span class="in">       y = "Number of Participants") +</span></span>
<span id="cb202-50"><a href="accessing-data-chapter.html#cb202-50" tabindex="-1"></a><span class="in">  theme_minimal(base_size = 16) +</span></span>
<span id="cb202-51"><a href="accessing-data-chapter.html#cb202-51" tabindex="-1"></a><span class="in">  theme(legend.position = "none",</span></span>
<span id="cb202-52"><a href="accessing-data-chapter.html#cb202-52" tabindex="-1"></a><span class="in">        panel.grid.minor = element_blank(),</span></span>
<span id="cb202-53"><a href="accessing-data-chapter.html#cb202-53" tabindex="-1"></a><span class="in">        panel.grid.major.x = element_blank(),</span></span>
<span id="cb202-54"><a href="accessing-data-chapter.html#cb202-54" tabindex="-1"></a><span class="in">        axis.title.y = element_blank(),</span></span>
<span id="cb202-55"><a href="accessing-data-chapter.html#cb202-55" tabindex="-1"></a><span class="in">        plot.title = element_text(face = "bold",</span></span>
<span id="cb202-56"><a href="accessing-data-chapter.html#cb202-56" tabindex="-1"></a><span class="in">                                  hjust = 0.5))</span></span>
<span id="cb202-57"><a href="accessing-data-chapter.html#cb202-57" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>These sections calculate the number of survey respondents, then put this in the text using inline R code; create a table that shows the respondents broken down by age group; and generate a graph that shows how many respondents like video games. Figure <a href="accessing-data-chapter.html#fig:video-game-report">11.3</a> shows the resulting report.</p>
<div class="figure">
<span style="display:block;" id="fig:video-game-report"></span>
<img src="assets/video-game-report.png" alt="The rendered video game report" width="100%"><p class="caption">
Figure 11.3: The rendered video game report
</p>
</div>
<p>We can re-run the code at any point to bring in updated data. Our survey had five responses today, but if we run it again tomorrow and it has additional responses, they will be included in the import. If you used Google Forms to run your survey and saved the results to a Google Sheet, you could produce this up-to-date report simply by clicking the Knit button in RStudio.</p>
</div>
<div id="importing-only-certain-columns" class="section level3 unnumbered">
<h3>Importing Only Certain Columns<a class="anchor" aria-label="anchor" href="#importing-only-certain-columns"><i class="fas fa-link"></i></a>
</h3>
<p>In the previous sections, we read the data of the entire Google Sheet. It is, however, possible to import only a section of a Sheet. For example, the survey data we imported includes a <code>timestamp</code> column. This variable is added automatically whenever someone submits a Google Form that pipes data into a Google Sheet, but we don’t use it in our analysis, so we could get rid of it.</p>
<p>To do this, use the <code>range</code> argument in the <code><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet()</a></code> function when importing the data. This argument lets us specify a range of data to bring. It uses the syntax you may have used to select columns in Google Sheets. In this example, I use <code>range = "Sheet1!B:E"</code> to import columns B through E (but not A, which contains the timestamp) before adding <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code>.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html">read_sheet</a></span><span class="op">(</span><span class="st">"https://docs.google.com/spreadsheets/d/1AR0_RcFBg8wdiY4Cj-k8vRypp_txh27MyZuiRdqScog/edit?usp=sharing"</span>,</span>
<span>           range <span class="op">=</span> <span class="st">"Sheet1!B:E"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Running this code produces output without the <code>timestamp</code> variable:</p>
<pre><code>#&gt; Rows: 5
#&gt; Columns: 4
#&gt; $ `How old are you?`                &lt;chr&gt; "25-34", "45-54"…
#&gt; $ `Do you like to play video games` &lt;chr&gt; "Yes", "No", "Ye…
#&gt; $ `What kind of games do you like?` &lt;chr&gt; "Sandbox, Role-P…
#&gt; $ `What's your favorite game?`      &lt;chr&gt; "It's hard to ch…</code></pre>
<p>There are a number of other functions in the <code>googlesheets4</code> package that you can use. For example, if you ever need to write your output back to a Google Sheet, the <code><a href="https://googlesheets4.tidyverse.org/reference/sheet_write.html">write_sheet()</a></code> function is there to help. To explore other functions in the package, check out its documentation website at <a href="https://googlesheets4.tidyverse.org/index.html" class="uri">https://googlesheets4.tidyverse.org/index.html</a>.</p>
</div>
</div>
<div id="accessing-census-data-with-tidycensus" class="section level2 unnumbered">
<h2>Accessing Census Data with <code>tidycensus</code><a class="anchor" aria-label="anchor" href="#accessing-census-data-with-tidycensus"><i class="fas fa-link"></i></a>
</h2>
<p>If you’ve ever worked with data from the United States Census Bureau, you know what a hassle it can be. Usually, the process involves visiting the Census Bureau website, searching the website for the data you need, downloading it, and then analyzing it in your tool of choice. This pointing and clicking gets very tedious over time.</p>
<p>Kyle Walker, a geographer at Texas Christian University, and Matt Herman (creator of the Westchester COVID-19 website discussed in Chapter <a href="websites-chapter.html#websites-chapter">9</a>) developed a package to automate the process of bringing Census Bureau data into R: the <code>tidycensus</code> package. With <code>tidycensus</code>, a user can write just a few lines of code to get data about, say, the median income in all counties in the United States.</p>
<p>This section shows you how the <code>tidycensus</code> package works using examples from two datasets to which it provides access: the Decennial Census administered every 10 years and the annual American Community Survey. We’ll also show you how to use the data from these two sources to perform additional analysis and make maps by accessing geospatial and demographic data simultaneously.</p>
<div id="connecting-to-the-census-bureau-with-an-api-key" class="section level3 unnumbered">
<h3>Connecting to the Census Bureau with an API Key<a class="anchor" aria-label="anchor" href="#connecting-to-the-census-bureau-with-an-api-key"><i class="fas fa-link"></i></a>
</h3>
<p>Begin by installing <code>tidycensus</code> using <code>install.packages("tidycensus")</code>. To use <code>tidycensus</code>, you must get an application programming interface (API) key from the Census Bureau. <em>API keys</em> are like passwords that allow online services to determine whether you are authorized to access data.</p>
<p>You can obtain this key, which is free, by going to <a href="https://api.census.gov/data/key_signup.html" class="uri">https://api.census.gov/data/key_signup.html</a> and entering your details. Once you receive the key by email, you need to put it in a place where tidycensus can find it. The <code><a href="https://walker-data.com/tidycensus/reference/census_api_key.html">census_api_key()</a></code> function does this for you, so after loading the <code>tidycensus</code> package, run the function as follows, replacing 123456789 with your actual API key:</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/census_api_key.html">census_api_key</a></span><span class="op">(</span><span class="st">"123456789"</span>, install <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The <code>install = TRUE</code> argument will save your API key in your <em>.Renviron</em> file, which is designed for storing confidential information like API keys. The package will look for your API key there in the future so that you don’t have to reenter it every time you use the package.</p>
<p>Now you can use <code>tidycensus</code> to access data. The most common of these are the Decennial Census and the American Community Survey. You can find a discussion of other datasets you can access in Chapter 2 of Kyle Walker’s book <em>Analyzing US Census Data: Methods, Maps, and Models in R</em>.</p>
</div>
<div id="working-with-decennial-census-data" class="section level3 unnumbered">
<h3>Working with Decennial Census Data<a class="anchor" aria-label="anchor" href="#working-with-decennial-census-data"><i class="fas fa-link"></i></a>
</h3>
<p>The Census Bureau puts out many datasets, several of which you can access using dedicated <code>tidycensus</code> functions. Let’s access data from the 2020 Decennial Census about the Asian population in each state using the <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> function with three arguments:</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>              variables <span class="op">=</span> <span class="st">"P1_006N"</span>,</span>
<span>              year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span></code></pre></div>
<p>The geography argument tells <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> to access data at the state level. In addition to the 50 states, it will return for the District of Columbia and Puerto Rico. There are many other geographies, including county, census tract, and more. The <code>variables</code> argument specifies the variable or variables we want to access. Here, <code>P2_002N</code> is the variable name for the total Asian population. We’ll discuss how to identify other variables you may want to use in the next section. Lastly, <code>year</code> specifies the year from which we want to access data. We’re using data from the 2020 Census.</p>
<p>Running this code returns the following:</p>
<pre><code>#&gt; # A tibble: 52 × 4
#&gt;    GEOID NAME                 variable   value
#&gt;    &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;      &lt;dbl&gt;
#&gt;  1 42    Pennsylvania         P1_006N   510501
#&gt;  2 06    California           P1_006N  6085947
#&gt;  3 54    West Virginia        P1_006N    15109
#&gt;  4 49    Utah                 P1_006N    80438
#&gt;  5 36    New York             P1_006N  1933127
#&gt;  6 11    District of Columbia P1_006N    33545
#&gt;  7 02    Alaska               P1_006N    44032
#&gt;  8 12    Florida              P1_006N   643682
#&gt;  9 45    South Carolina       P1_006N    90466
#&gt; 10 38    North Dakota         P1_006N    13213
#&gt; # ℹ 42 more rows</code></pre>
<p>The resulting data frame has four variables. <code>GEOID</code> is the geographic identifier given by the Census Bureau for the state. Each state has a geographic identifier, as do all counties, census tracts, and other geographies. <code>NAME</code> is the name of each state, and <code>variable</code> is the name of the variable we passed to the <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> function. Lastly, <code>value</code> is the numeric value for the state and variable in each row. In this case, it represents the total Asian population in each state.</p>
<div id="identifying-census-variable-values" class="section level4 unnumbered">
<h4>Identifying Census Variable Values<a class="anchor" aria-label="anchor" href="#identifying-census-variable-values"><i class="fas fa-link"></i></a>
</h4>
<p>To pass a specific variable to <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code>, you have to first look it up. Let’s say we want to calculate the Asian population as a percentage of all people in each state. To do that, we’d first need to retrieve the variable for the state’s total population.</p>
<p>The <code>tidycensus</code> package has a function called <code><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables()</a></code> that shows all of the variables from a Decennial Census. Run it with the <code>year</code> argument set to 2020 and <code>dataset</code> set to <code>pl</code>. This should pull data from so-called redistricting summary data files, which public law 94-171 requires the census to produce every 10 years:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2020</span>, </span>
<span>               dataset <span class="op">=</span> <span class="st">"pl"</span><span class="op">)</span></span></code></pre></div>
<p>Running this code returns the name, label (a description), and concept (a category) of all variables available to us:</p>
<pre><code>#&gt; # A tibble: 301 × 3
#&gt;    name    label                                     concept
#&gt;    &lt;chr&gt;   &lt;chr&gt;                                     &lt;chr&gt;  
#&gt;  1 H1_001N " !!Total:"                               OCCUPA…
#&gt;  2 H1_002N " !!Total:!!Occupied"                     OCCUPA…
#&gt;  3 H1_003N " !!Total:!!Vacant"                       OCCUPA…
#&gt;  4 P1_001N " !!Total:"                               RACE   
#&gt;  5 P1_002N " !!Total:!!Population of one race:"      RACE   
#&gt;  6 P1_003N " !!Total:!!Population of one race:!!Whi… RACE   
#&gt;  7 P1_004N " !!Total:!!Population of one race:!!Bla… RACE   
#&gt;  8 P1_005N " !!Total:!!Population of one race:!!Ame… RACE   
#&gt;  9 P1_006N " !!Total:!!Population of one race:!!Asi… RACE   
#&gt; 10 P1_007N " !!Total:!!Population of one race:!!Nat… RACE   
#&gt; # ℹ 291 more rows</code></pre>
<p>By looking at this list, you can see that the variable <code>P1_001N</code> gives us the total population.</p>
</div>
<div id="using-multiple-census-variables" class="section level4 unnumbered">
<h4>Using Multiple Census Variables<a class="anchor" aria-label="anchor" href="#using-multiple-census-variables"><i class="fas fa-link"></i></a>
</h4>
<p>Now that we know which variables we need, we can use the <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> function again with two variables at once:</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>              variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P1_001N"</span>, <span class="st">"P1_006N"</span><span class="op">)</span>,</span>
<span>              year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span></span></code></pre></div>
<p>We add <code>arrange(NAME)</code> after <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> so that the results are sorted by state name, allowing us to see that we have both variables for each state:</p>
<pre><code>#&gt; # A tibble: 104 × 4
#&gt;    GEOID NAME       variable    value
#&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
#&gt;  1 01    Alabama    P1_001N   5024279
#&gt;  2 01    Alabama    P1_006N     76660
#&gt;  3 02    Alaska     P1_001N    733391
#&gt;  4 02    Alaska     P1_006N     44032
#&gt;  5 04    Arizona    P1_001N   7151502
#&gt;  6 04    Arizona    P1_006N    257430
#&gt;  7 05    Arkansas   P1_001N   3011524
#&gt;  8 05    Arkansas   P1_006N     51839
#&gt;  9 06    California P1_001N  39538223
#&gt; 10 06    California P1_006N   6085947
#&gt; # ℹ 94 more rows</code></pre>
<p>If you’re working with multiple census variables, however, you might have trouble remembering what names like <code>P1_001N</code> and <code>P1_006N</code> mean. Fortunately, we can adjust the code in the call to <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> to give these variables more meaningful names using the following syntax:</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>              variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>total_population <span class="op">=</span> <span class="st">"P1_001N"</span>, </span>
<span>                            asian_population <span class="op">=</span> <span class="st">"P1_006N"</span><span class="op">)</span>,</span>
<span>              year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span></span></code></pre></div>
<p>Within the <code>variables</code> argument, we give the name we want our variables to have, followed by the equal sign and the original variable name. We can rename multiple variables by putting them within the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function, as I’ve done here. It should now be much easier to see which variables we’re working with:</p>
<pre><code>#&gt; # A tibble: 104 × 4
#&gt;    GEOID NAME       variable            value
#&gt;    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;               &lt;dbl&gt;
#&gt;  1 01    Alabama    total_population  5024279
#&gt;  2 01    Alabama    asian_population    76660
#&gt;  3 02    Alaska     total_population   733391
#&gt;  4 02    Alaska     asian_population    44032
#&gt;  5 04    Arizona    total_population  7151502
#&gt;  6 04    Arizona    asian_population   257430
#&gt;  7 05    Arkansas   total_population  3011524
#&gt;  8 05    Arkansas   asian_population    51839
#&gt;  9 06    California total_population 39538223
#&gt; 10 06    California asian_population  6085947
#&gt; # ℹ 94 more rows</code></pre>
<p>Instead of <code>P1_001N</code> and <code>P1_006N</code>, we have <code>total_population</code> and <code>asian_population</code>. Much better!</p>
</div>
</div>
<div id="analyzing-census-data" class="section level3 unnumbered">
<h3>Analyzing Census Data<a class="anchor" aria-label="anchor" href="#analyzing-census-data"><i class="fas fa-link"></i></a>
</h3>
<p>Now we have the data we need to calculate the Asian population in each state as a percentage of the total. To do this, we add a few things to the code from the previous section:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>              variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>total_population <span class="op">=</span> <span class="st">"P1_001N"</span>, </span>
<span>                            asian_population <span class="op">=</span> <span class="st">"P1_006N"</span><span class="op">)</span>,</span>
<span>              year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"asian_population"</span><span class="op">)</span></span></code></pre></div>
<p>We use <code>group_by(NAME)</code> to create one group for each state because we want to calculate the Asian population percentage in each state (not for the entire United States). We then use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to calculate each percentage, taking the value in each row and dividing it by the <code>total_population</code> and <code>asian_population</code> rows for each state. We use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> to remove the state-level grouping. We use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to show only the Asian population percentage.</p>
<p>When we run this code, we see both the Asian population and the Asian population as a percentage of the total population in each state:</p>
<pre><code>#&gt; # A tibble: 52 × 5
#&gt;    GEOID NAME                 variable        value      pct
#&gt;    &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1 01    Alabama              asian_popula…   76660 0.015029
#&gt;  2 02    Alaska               asian_popula…   44032 0.056638
#&gt;  3 04    Arizona              asian_popula…  257430 0.034746
#&gt;  4 05    Arkansas             asian_popula…   51839 0.016922
#&gt;  5 06    California           asian_popula… 6085947 0.13339 
#&gt;  6 08    Colorado             asian_popula…  199827 0.033452
#&gt;  7 09    Connecticut          asian_popula…  172455 0.045642
#&gt;  8 10    Delaware             asian_popula…   42699 0.041349
#&gt;  9 11    District of Columbia asian_popula…   33545 0.046391
#&gt; 10 12    Florida              asian_popula…  643682 0.029018
#&gt; # ℹ 42 more rows</code></pre>
<p>This is one way to calculate the Asian population as a percentage of the total population in each state, but it’s not the only way.</p>
<div id="using-a-summary-variable" class="section level4 unnumbered">
<h4>Using a Summary Variable<a class="anchor" aria-label="anchor" href="#using-a-summary-variable"><i class="fas fa-link"></i></a>
</h4>
<p>Kyle Walker knew that calculating summaries like we’ve just done would be a common use case for <code>tidycensus</code>. To calculate, say, the Asian population as a percentage of the whole, you need to have a numerator (the Asian population) and denominator (the total population). So, to simplify things, he gives us the <code>summary_var</code> argument that we can use within <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> to import the total population as a separate variable. Instead of putting <code>P1_001N</code> (total population) in the <code>variables</code> argument, we can use it with the <code>summary_var</code> argument as follows.</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>              variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>asian_population <span class="op">=</span> <span class="st">"P1_006N"</span><span class="op">)</span>,</span>
<span>              summary_var <span class="op">=</span> <span class="st">"P1_001N"</span>,</span>
<span>              year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span></span></code></pre></div>
<p>This returns a nearly identical data frame to what we got earlier, except that the total population is now a separate variable, rather than additional rows for each state:</p>
<pre><code>#&gt; # A tibble: 52 × 5
#&gt;    GEOID NAME                 variable   value summary_value
#&gt;    &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;      &lt;dbl&gt;         &lt;dbl&gt;
#&gt;  1 01    Alabama              asian_p…   76660       5024279
#&gt;  2 02    Alaska               asian_p…   44032        733391
#&gt;  3 04    Arizona              asian_p…  257430       7151502
#&gt;  4 05    Arkansas             asian_p…   51839       3011524
#&gt;  5 06    California           asian_p… 6085947      39538223
#&gt;  6 08    Colorado             asian_p…  199827       5773714
#&gt;  7 09    Connecticut          asian_p…  172455       3605944
#&gt;  8 10    Delaware             asian_p…   42699        989948
#&gt;  9 11    District of Columbia asian_p…   33545        689545
#&gt; 10 12    Florida              asian_p…  643682      21538187
#&gt; # ℹ 42 more rows</code></pre>
<p>With our data in this new format, we can calculate the Asian population as a percentage of the whole by dividing the <code>value</code> variable by the <code>summary_value</code> variable. Then we drop the <code>summary_value</code> variable because we no longer need it after doing our calculation:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>              variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>asian_population <span class="op">=</span> <span class="st">"P1_006N"</span><span class="op">)</span>,</span>
<span>              summary_var <span class="op">=</span> <span class="st">"P1_001N"</span>,</span>
<span>              year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">NAME</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pct <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="va">summary_value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">summary_value</span><span class="op">)</span></span></code></pre></div>
<p>The resulting output is identical to the output of the previous section:</p>
<pre><code>#&gt; # A tibble: 52 × 6
#&gt;    GEOID NAME        variable   value summary_value      pct
#&gt;    &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1 01    Alabama     asian_p…   76660       5024279 0.015258
#&gt;  2 02    Alaska      asian_p…   44032        733391 0.060039
#&gt;  3 04    Arizona     asian_p…  257430       7151502 0.035997
#&gt;  4 05    Arkansas    asian_p…   51839       3011524 0.017214
#&gt;  5 06    California  asian_p… 6085947      39538223 0.15393 
#&gt;  6 08    Colorado    asian_p…  199827       5773714 0.034610
#&gt;  7 09    Connecticut asian_p…  172455       3605944 0.047825
#&gt;  8 10    Delaware    asian_p…   42699        989948 0.043133
#&gt;  9 11    District o… asian_p…   33545        689545 0.048648
#&gt; 10 12    Florida     asian_p…  643682      21538187 0.029886
#&gt; # ℹ 42 more rows</code></pre>
<p>How you choose to calculate summary statistics is up to you; <code>tidycensus</code> makes it easy to do either way.</p>
</div>
<div id="visualizing-american-community-survey-data" class="section level4 unnumbered">
<h4>Visualizing American Community Survey Data<a class="anchor" aria-label="anchor" href="#visualizing-american-community-survey-data"><i class="fas fa-link"></i></a>
</h4>
<p>Once you’ve accessed data using the <code>tidycensus</code> package, you can do whatever you want with it. Let’s practice analyzing and visualizing survey data using the American Community Survey. This survey, which is conducted every year, differs from the decennial Census in two major ways: It is given to a sample of people rather than the entire population, and it includes a wider range of questions.</p>
<p>Despite these differences, we can access data from the American Community Survey in a manner nearly identical to how we access Decennial Census data. Instead of <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code>, we use the function <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code>, but the arguments we pass to these functions are the same. In the following example, I’ve identified a variable I’m interested in (<code>B01002_001</code>, which shows the median age) and use it to get this data for each state:</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>        variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>        year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span></code></pre></div>
<p>Here is what the output looks like:</p>
<pre><code>#&gt; # A tibble: 52 × 5
#&gt;    GEOID NAME                 variable   estimate   moe
#&gt;    &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1 01    Alabama              B01002_001     39.2   0.1
#&gt;  2 02    Alaska               B01002_001     34.6   0.2
#&gt;  3 04    Arizona              B01002_001     37.9   0.2
#&gt;  4 05    Arkansas             B01002_001     38.3   0.2
#&gt;  5 06    California           B01002_001     36.7   0.1
#&gt;  6 08    Colorado             B01002_001     36.9   0.1
#&gt;  7 09    Connecticut          B01002_001     41.1   0.2
#&gt;  8 10    Delaware             B01002_001     41     0.2
#&gt;  9 11    District of Columbia B01002_001     34.1   0.1
#&gt; 10 12    Florida              B01002_001     42.2   0.2
#&gt; # ℹ 42 more rows</code></pre>
<p>You should notice two differences in the output from <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> compared to that from <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code>. First, instead of the value column, <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> produces a column called <code>estimate</code>. It also produces an additional column called <code>moe</code>, for the margin of error. We see these changes because the American Community Survey is given to a sample of the population. As a result, we must extrapolate values from that sample to the population as a whole, and with such an estimate comes a margin of error.</p>
<p>In the state-level data, the margins of error are relatively low, but if you get data from smaller geographies, they tend to be higher. In cases where your margins of error are high relative to your estimates, you should interpret results with caution, as there is greater uncertainty about how well the data represents the population as a whole.</p>
</div>
<div id="making-charts" class="section level4 unnumbered">
<h4>Making Charts<a class="anchor" aria-label="anchor" href="#making-charts"><i class="fas fa-link"></i></a>
</h4>
<p>Here is how we could take the data on median age and pipe it into ggplot to create a bar chart:</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>        variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>        year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>             y <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We import data with the <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> function and then pipe this directly into ggplot. We put states (which use the variable <code>NAME</code>) on the y axis and median age (<code>estimate</code>) on the x axis. A simple <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> creates the bar chart, shown in Figure <a href="accessing-data-chapter.html#fig:median-age-chart">11.4</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:median-age-chart"></span>
<img src="accessing-data_files/figure-html/median-age-chart-1.png" alt="A bar chart showing the median age in each state" width="100%"><p class="caption">
Figure 11.4: A bar chart showing the median age in each state
</p>
</div>
<p>This chart is nothing special, but the fact that it takes just six lines of code to create most definitely is.</p>
</div>
<div id="making-population-maps-with-the-geometry-argument" class="section level4 unnumbered">
<h4>Making Population Maps with the <code>geometry</code> Argument<a class="anchor" aria-label="anchor" href="#making-population-maps-with-the-geometry-argument"><i class="fas fa-link"></i></a>
</h4>
<p>Kyle Walker, the creator of <code>tidycensus</code>, also created the <code>tigris</code> package for working with geospatial data. As a result, these packages are tightly integrated. Within the <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> function, you can set the <code>geometry</code> argument to <code>TRUE</code> to receive both demographic data from the Census Bureau and geospatial data from <code>tigris</code>:</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>        variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>        year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>        geometry <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
<p>If we take a look at the resulting data, we can see that it has the metadata and <code>geometry</code> column of the simple features objects that we saw in Chapter <a href="maps-chapter.html#maps-chapter">4</a>.</p>
<pre><code>#&gt; Simple feature collection with 52 features and 5 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -179.1467 ymin: 17.88328 xmax: 179.7785 ymax: 71.38782
#&gt; Geodetic CRS:  NAD83
#&gt; First 10 features:
#&gt;    GEOID         NAME   variable estimate moe
#&gt; 1     35   New Mexico B01002_001     38.1 0.1
#&gt; 2     46 South Dakota B01002_001     37.2 0.2
#&gt; 3     06   California B01002_001     36.7 0.1
#&gt; 4     21     Kentucky B01002_001     39.0 0.1
#&gt; 5     01      Alabama B01002_001     39.2 0.1
#&gt; 6     13      Georgia B01002_001     36.9 0.1
#&gt; 7     05     Arkansas B01002_001     38.3 0.2
#&gt; 8     42 Pennsylvania B01002_001     40.9 0.2
#&gt; 9     29     Missouri B01002_001     38.7 0.2
#&gt; 10    08     Colorado B01002_001     36.9 0.1
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-109.0502 3...
#&gt; 2  MULTIPOLYGON (((-104.0579 4...
#&gt; 3  MULTIPOLYGON (((-118.6044 3...
#&gt; 4  MULTIPOLYGON (((-89.41728 3...
#&gt; 5  MULTIPOLYGON (((-88.05338 3...
#&gt; 6  MULTIPOLYGON (((-81.27939 3...
#&gt; 7  MULTIPOLYGON (((-94.61792 3...
#&gt; 8  MULTIPOLYGON (((-80.51989 4...
#&gt; 9  MULTIPOLYGON (((-95.77355 4...
#&gt; 10 MULTIPOLYGON (((-109.0603 3...</code></pre>
<p>We can see that the geometry type is MULTIPOLYGON, which you learned about in Chapter <a href="maps-chapter.html#maps-chapter">4</a>. We can pipe this data into ggplot to make a map with the following code:</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>        variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>        year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>        geometry <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Here, we import the data with the <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> function before piping it into the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function. We set the estimate variable to use for the <code>fill</code> aesthetic property; that is, the fill color of each state will vary depending on the median age of its residents. Then we use <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> to draw the map. The <code><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c()</a></code> function gives us a colorblind-friendly palette.</p>
<p>The resulting map, seen in Figure <a href="accessing-data-chapter.html#fig:median-age-map-bad">11.5</a>, is less than ideal because the Aleutian Islands in Alaska cross the 180-degree line of longitude, also known as the <em>international date line</em>. As a result, most of Alaska appears on one side of the map while a small part appears on the other side. What’s more, both Hawaii and Puerto Rico are hard to see.</p>
<div class="figure">
<span style="display:block;" id="fig:median-age-map-bad"></span>
<img src="accessing-data_files/figure-html/median-age-map-bad-1.png" alt="A hard-to-read map showing median age by state" width="100%"><p class="caption">
Figure 11.5: A hard-to-read map showing median age by state
</p>
</div>
<p>To fix these problems, load the tigris package, then use the <code><a href="https://rdrr.io/pkg/tigris/man/shift_geometry.html">shift_geometry()</a></code> function to move Alaska, Hawaii, and Puerto Rico into places where they’ll be more easily visible:</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/tigris">tigris</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>        variables <span class="op">=</span> <span class="st">"B01002_001"</span>,</span>
<span>        year <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>        geometry <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tigris/man/shift_geometry.html">shift_geometry</a></span><span class="op">(</span>preserve_area <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We set the <code>preserve_area</code> argument to <code>FALSE</code> to shrink the giant state of Alaska and make Hawaii and Puerto Rico larger. Although the state sizes in the map won’t be precise, the map will be easier to read, as you can see in Figure <a href="accessing-data-chapter.html#fig:median-age-map-good">11.6</a>.</p>
<div class="figure">
<span style="display:block;" id="fig:median-age-map-good"></span>
<img src="accessing-data_files/figure-html/median-age-map-good-1.png" alt="An easier-to-read map showing median age by state" width="100%"><p class="caption">
Figure 11.6: An easier-to-read map showing median age by state
</p>
</div>
<p>We’ve made a map that shows the median age by state. As an exercise, try making the same map for all 3,000 counties by changing the <code>geography</code> argument to <code>"county"</code>. Other geographies include region, tract (for census tracts), place (for census-designated places, more commonly known as towns and cities), congressional district, and more. Chapter 2 of Kyle Walker’s book <em>Analyzing US Census Data: Methods, Maps, and Models in R</em> discusses the various geographies available. There are also many more arguments in both the <code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code> and <code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code> functions. We’ve shown only a few of the most common. If you want to learn more, Walker’s book is a great resource.</p>
</div>
</div>
</div>
<div id="packages-like-googlesheets4-and-tidycensus-make-it-easy-to-access-data" class="section level2 unnumbered">
<h2>Packages like <code>googlesheets4</code> and <code>tidycensus</code> Make it Easy to Access Data<a class="anchor" aria-label="anchor" href="#packages-like-googlesheets4-and-tidycensus-make-it-easy-to-access-data"><i class="fas fa-link"></i></a>
</h2>
<p>This chapter explored two packages that use APIs to access data directly from its source. The <code>googlesheets4</code> package lets you import data from a Google Sheet. It’s particularly useful when you’re working with survey data, as it makes it easy to update your reports when new results come in. If you don’t work with Sheets, you could use similar packages to fetch data from Excel365 (<code>Microsoft365R</code>), Qualtrics (<code>qualtRics</code>), Survey Monkey (<code>surveymonkey</code>), and other sources.</p>
<p>If you work with US census data, the <code>tidycensus</code> package is a huge timesaver. Rather than having to manually download data from the Census Bureau website, you can use it to write R code that accesses it automatically, making it ready for analysis and reporting. Because of its integration with <code>tigris</code>, you can also easily map this demographic data.</p>
<p>If you’re looking for census data from other countries, Walker’s <em>Analyzing US Census Data</em> book gives examples of packages that can help. There are R packages to bring census data from Canada (<code>cancensus</code>), Kenya (<code>rKenyaCensus</code>), Mexico (<code>mxmaps</code> and <code>inegiR</code>), Europe (<code>eurostat</code>), and other countries. Before hitting the download button in your data collection tool of choice, it’s worth looking for a package that can import that data directly into R.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="quarto-chapter.html"><span class="header-section-number">10</span> Reproducible Reporting with Quarto</a></div>
<div class="next"><a href="packages-chapter.html"><span class="header-section-number">12</span> Creating Your Own R Packages</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#accessing-data-chapter"><span class="header-section-number">11</span> Accessing Data</a></li>
<li>
<a class="nav-link" href="#importing-data-from-google-sheets-with-googlesheets4">Importing Data from Google Sheets with googlesheets4</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#connecting-to-google">Connecting to Google</a></li>
<li><a class="nav-link" href="#reading-data-from-a-sheet">Reading Data from a Sheet</a></li>
<li><a class="nav-link" href="#using-the-data-in-r-markdown">Using the Data in R Markdown</a></li>
<li><a class="nav-link" href="#importing-only-certain-columns">Importing Only Certain Columns</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#accessing-census-data-with-tidycensus">Accessing Census Data with tidycensus</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#connecting-to-the-census-bureau-with-an-api-key">Connecting to the Census Bureau with an API Key</a></li>
<li><a class="nav-link" href="#working-with-decennial-census-data">Working with Decennial Census Data</a></li>
<li><a class="nav-link" href="#analyzing-census-data">Analyzing Census Data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#packages-like-googlesheets4-and-tidycensus-make-it-easy-to-access-data">Packages like googlesheets4 and tidycensus Make it Easy to Access Data</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rfortherestofus/r-without-statistics/blob/master/accessing-data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rfortherestofus/r-without-statistics/edit/master/accessing-data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Without Statistics</strong>" was written by David Keyes. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
