<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>The Briefest of Primers on Geospatial Data | R Without Statistics</title>

    <meta name="author" content="David Keyes" />
  
   <meta name="description" content="Since R was invented in 1993, it has become a widely used programming language for statistical analysis. From academia to the tech world and beyond, R is used for a wide range of statistical analysis. R Without Statistics will show ways that R can be used beyond complex statistical analysis. Readers will learn about a range of uses for R, many of which they have likely never even considered." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="The Briefest of Primers on Geospatial Data | R Without Statistics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://book.rwithoutstatistics.com" />
  <meta property="og:image" content="https://book.rwithoutstatistics.com/mock-cover.png" />
  <meta property="og:description" content="Since R was invented in 1993, it has become a widely used programming language for statistical analysis. From academia to the tech world and beyond, R is used for a wide range of statistical analysis. R Without Statistics will show ways that R can be used beyond complex statistical analysis. Readers will learn about a range of uses for R, many of which they have likely never even considered." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The Briefest of Primers on Geospatial Data | R Without Statistics" />
  
  <meta name="twitter:description" content="Since R was invented in 1993, it has become a widely used programming language for statistical analysis. From academia to the tech world and beyond, R is used for a wide range of statistical analysis. R Without Statistics will show ways that R can be used beyond complex statistical analysis. Readers will learn about a range of uses for R, many of which they have likely never even considered." />
  <meta name="twitter:image" content="https://book.rwithoutstatistics.com/mock-cover.png" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.4.1/transition.js"></script>
    <script src="libs/bs3compat-0.4.1/tabs.js"></script>
    <script src="libs/bs3compat-0.4.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R Without Statistics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="the-briefest-of-primers-on-geospatial-data" class="section level1 unnumbered">
<h1>The Briefest of Primers on Geospatial Data</h1>
<p>You don’t need to be a GIS expert to make maps (I’m not and I do). But you do need to understand a few things about how geospatial data works. Here is the briefest of primers on geospatial data.</p>
<p>There are two main types of geospatial data: vector and raster. Vector data uses points, lines, and polygons to represent the world. Raster data, which often comes from digital photographs, ties each pixel in the photograph to a specific geographic location. Vector data tends to be simpler to work with, and we will be using it exclusively in this chapter (when I use the term “geospatial data” in this chapter, I’m referring to vector data).</p>
<p>If you are making maps today in R, consider yourself lucky. Changes in recent years have made it much simpler to work with geospatial data, and to build maps with R. Before then, there were competing standards for geospatial data, and each standard required learning a different approach. Today, though, the simple features model (often abbreviated as sf) for working with vector geospatial data has become dominant. You should be grateful, as simple features data is way easier to work with than were previous geospatial data models.</p>
<p>Geospatial data is both very similar to data you’re already used to working with in R and, in some ways, very different. To see the similarities and differences, let’s look at how simple features data works. In this section, I’ll just show you data and the maps we make with that data, providing the bare minimum you need to know in order to understand how simple features data works. This section won’t show code, but the sections that follow, which explain how to work with geospatial data, will.</p>
<p>Let’s begin by taking a look at some simple features geospatial data that represents the U.S. state of Wyoming. Here’s what it looks like.</p>
<pre><code>#&gt; Simple feature collection with 1 feature and 1 field
#&gt; Geometry type: POLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0546 ymin: 40.99477 xmax: -104.0522 ymax: 45.00582
#&gt; Geodetic CRS:  WGS 84
#&gt;      NAME                       geometry
#&gt; 1 Wyoming POLYGON ((-111.0449 43.3157...</code></pre>
<p>You can see that we have a column for state name (<code>NAME</code>) and another column called <code>geometry</code>. Overall, this looks like the output we’re used to seeing with data in a data frame. But there are two major differences:</p>
<ol style="list-style-type: decimal">
<li>There is a bunch of metadata above the data frame</li>
<li>Our simple features data has a <code>geometry</code> column</li>
</ol>
<p>You can see these differences highlighted in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:sf-data-output">5.2</a> below.</p>
<div class="figure"><span style="display:block;" id="fig:sf-data-output"></span>
<img src="assets/sf-data.png" alt="The output of sf data with metadata and the geometry column highlighted" width="100%" />
<p class="caption">
Figure 5.2: The output of sf data with metadata and the geometry column highlighted
</p>
</div>
<p>Let’s discuss each of these differences, starting with metadata. Above the main output, we see a section that starts with the text “Simple feature collection with 1 feature and 1 field.” The feature here is the row and the field is the variable (<code>NAME</code>) that contains non-spatial data (the <code>geometry</code> column, which contains geospatial data, will be discussed below). This line, and the lines that follow, are metadata about the geospatial data in the <code>wyoming</code> object. Let’s look at each piece of the metadata.</p>
<div id="geometry-type" class="section level2 unnumbered">
<h2>Geometry Type</h2>
<p>The geometry type shows the type of geospatial data we’re working with. POLYGON (geometry types are typically written in all caps) means a relatively simple shape that can be represented by a single polygon. We can use ggplot to display this data. Note that <code>geom_sf()</code> is a special geom designed to work with simple features (sf) data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb2-1" aria-hidden="true" tabindex="-1"></a>wyoming <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p>We can see the resulting map of Wyoming. It may not look like much, but, hey, I wasn’t the one who chose to make Wyoming a nearly perfect rectangle!</p>
<div class="figure"><span style="display:block;" id="fig:wyoming-map-plot"></span>
<img src="maps_files/figure-html/wyoming-map-plot-1.png" alt="A map of Wyoming" width="100%" />
<p class="caption">
Figure 5.3: A map of Wyoming
</p>
</div>
<p>POLYGON is one of several geometry types that sf data can be used to represent. Others include:</p>
<p>POINT: Used to display something like a pin on a map that shows a single location. Here’s a map showing the location of a single electric vehicle charging station in Wyoming.</p>
<div class="figure"><span style="display:block;" id="fig:ev-stations-map"></span>
<img src="maps_files/figure-html/ev-stations-map-1.png" alt="A map of a single electric vehicle charging station in Wyoming" width="100%" />
<p class="caption">
Figure 5.4: A map of a single electric vehicle charging station in Wyoming
</p>
</div>
<p>LINESTRING: A set of points that can be connected with lines, this geometry type is often used to represent roads. Here’s an example I’ve added of a LINESTRING showing a section of U.S. Highway 30 that runs through Wyoming.</p>
<div class="figure"><span style="display:block;" id="fig:wy-roads-map"></span>
<img src="maps_files/figure-html/wy-roads-map-1.png" alt="A map of a section of U.S. Highway 30 running through Wyoming" width="100%" />
<p class="caption">
Figure 5.5: A map of a section of U.S. Highway 30 running through Wyoming
</p>
</div>
<p>Each of these has a MULTI- variation (MULTIPOINT, MULTILINESTRING, and MULTIPOLYGON) to combine multiple instances of their “single” variation in one row of data. For example, the data used to make Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:wyoming-ev-stations-map">5.6</a> below, which shows all electric vehicle charging stations in Wyoming, is MULTIPOINT.</p>
<div class="figure"><span style="display:block;" id="fig:wyoming-ev-stations-map"></span>
<img src="maps_files/figure-html/wyoming-ev-stations-map-1.png" alt="A map of all electric vehicle charging stations in Wyoming" width="100%" />
<p class="caption">
Figure 5.6: A map of all electric vehicle charging stations in Wyoming
</p>
</div>
<p>MULTILINESTRING data can be seen if we show not one road, but all major roads in Wyoming, as in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:wyoming-roads-map">5.7</a>.</p>
<div class="figure"><span style="display:block;" id="fig:wyoming-roads-map"></span>
<img src="maps_files/figure-html/wyoming-roads-map-1.png" alt="A map of all major roads in Wyoming" width="100%" />
<p class="caption">
Figure 5.7: A map of all major roads in Wyoming
</p>
</div>
<p>MULTIPOLYGON data occurs when, for example, we have a state made up of multiple polygons. To see what I mean, let’s take a look at a map of Wyoming counties. First, let’s look at simple features data used to represent the 23 counties in the state. We can see that the geometry type of this data is MULTIPOLYGON (in addition, the repeated MULTIPOLYGON text in the <code>geometry</code> column indicates that each row contains a shape of type MULTIPOLYGON; see section on the <code>geometry</code> column below).</p>
<pre><code>#&gt; Simple feature collection with 23 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -111.0546 ymin: 40.99477 xmax: -104.0522 ymax: 45.00582
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;             NAME                       geometry
#&gt; 34       Lincoln MULTIPOLYGON (((-111.0472 4...
#&gt; 104      Fremont MULTIPOLYGON (((-109.4582 4...
#&gt; 121        Uinta MULTIPOLYGON (((-110.6068 4...
#&gt; 527     Big Horn MULTIPOLYGON (((-108.5923 4...
#&gt; 551  Hot Springs MULTIPOLYGON (((-109.1714 4...
#&gt; 601     Washakie MULTIPOLYGON (((-107.6335 4...
#&gt; 769     Converse MULTIPOLYGON (((-105.6985 4...
#&gt; 970   Sweetwater MULTIPOLYGON (((-110.0489 4...
#&gt; 977        Crook MULTIPOLYGON (((-105.0856 4...
#&gt; 1097      Carbon MULTIPOLYGON (((-106.9129 4...</code></pre>
<p>Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:wyoming-counties-map">5.8</a> is a map made with this data. You can see the multiple polygons that make up the map.</p>
<div class="figure"><span style="display:block;" id="fig:wyoming-counties-map"></span>
<img src="maps_files/figure-html/wyoming-counties-map-1.png" alt="A map of Wyoming counties" width="100%" />
<p class="caption">
Figure 5.8: A map of Wyoming counties
</p>
</div>
</div>
<div id="dimensions" class="section level2 unnumbered">
<h2>Dimensions</h2>
<p>The next line we see in our geospatial data frame metadata is dimension. For our Wyoming data, we had the text <code>Dimension: XY</code>. Dimensions refer to the type of geospatial data we’re working with. When we see <code>XY</code>, this means the data is two-dimensional. This is what we will see in all of the geospatial data used in this chapter. There are two other dimensions (<code>Z</code> and <code>M</code>) that you see much more rarely. Since <code>Z</code> and <code>M</code> are both less common and not relevant to the maps we’re discussing in this chapter, I’ll leave them for you to investigate further.</p>
</div>
<div id="bounding-box" class="section level2 unnumbered">
<h2>Bounding Box</h2>
<p>The penultimate element we see in the metadata is the bounding box. For our <code>wyoming</code> object, it looks like this:</p>
<p><code>Bounding box:  xmin: -111.0569 ymin: 40.99475 xmax: -104.0522 ymax: 45.0059</code></p>
<p>A bounding box represents the smallest area in which we can fit all of our geospatial data. What we see in our metadata is the four corners of this bounding box. For Wyoming, the <code>ymin</code> value of 40.99475 and <code>ymax</code> value of 45.0059 represent the lowest and highest latitude, respectively, that the polygon that represents the state can fit into (the x values do the same for longitude). Bounding boxes are calculated automatically and are not typically something you have to worry about altering.</p>
</div>
<div id="geodetic-crs" class="section level2 unnumbered">
<h2>Geodetic CRS</h2>
<p>The final piece of metadata above our data frame is the “Geodetic CRS.” This refers to the coordinate reference system (CRS) used to project our data when we plot it. The problem with representing any geospatial data is that we’re projecting data used to represent the three-dimensional earth onto a two-dimensional map. Doing so requires us to choose a coordinate reference system that determines what type of projection to use when making our map.</p>
<p>Let’s look at a couple projections of our map of Wyoming counties. We’ll begin by looking at the data we’re using to make our maps. As we can see in the line <code>Geodetic CRS:  WGS 84</code>, this uses a coordinate reference system known as WGS84. If we plot our map with this data, Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:wyoming-counties-map-wgs84">5.9</a> what it looks like.</p>
<div class="figure"><span style="display:block;" id="fig:wyoming-counties-map-wgs84"></span>
<img src="maps_files/figure-html/wyoming-counties-map-wgs84-1.png" alt="A map of Wyoming counties using the WGS84 projection" width="100%" />
<p class="caption">
Figure 5.9: A map of Wyoming counties using the WGS84 projection
</p>
</div>
<p>To see how different a map that uses a different projection can look, check out another map of Wyoming counties, this time using what’s known as the “Albers equal-area conic convenience projection.” Whereas Wyoming looked perfectly horizontal in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:wyoming-counties-map-wgs84">5.9</a> above, in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:wyoming-counties-map-5070">5.10</a> below it appears to be tilted.</p>
<div class="figure"><span style="display:block;" id="fig:wyoming-counties-map-5070"></span>
<img src="maps_files/figure-html/wyoming-counties-map-5070-1.png" alt="A map of Wyoming counties using the Albers equal-area conic convenience projection" width="100%" />
<p class="caption">
Figure 5.10: A map of Wyoming counties using the Albers equal-area conic convenience projection
</p>
</div>
<p>If you’re curious about how to change projections when making maps of your own, fear not. You’ll see how to do this when we look at Abdoul Madjid’s map. And if you want to know how to choose appropriate projections for your maps, check out the conclusion of the chapter.</p>
<div id="the-geometry-column" class="section level3 unnumbered">
<h3>The <code>geometry</code> Column</h3>
<p>In addition to the metadata above our data frame, there is another difference between geospatial data and traditional data frames. All simple features data has a <code>geometry</code> column. As you probably guessed from the name, this column holds the data needed to make our maps.</p>
<p>Think back to when you were a kid and you did connect-the-dots drawings. As you added lines to connect one point to the next, the subject of your drawing was eventually revealed. The geometry column is similar. It has a set of numbers, each of which corresponds to a point. If you’re using LINESTRING/MULTILINESTRING or POLYGON/MULTIPOLYGON simple features data, ggplot uses the data in the geometry column to draw each point and then add lines to connect the points (if you’re using POINT/MULTIPOINT data, it just draws the points but doesn’t connect them).</p>
<p>If it sounds complicated, don’t worry: you never have to worry about the details. The first time I looked in any depth at a geometry column was when I wrote this chapter. What you need to know is this: simple features data has a <code>geometry</code> column, and it’s what ggplot uses to make maps.</p>
</div>
</div>
<div id="recreating-the-covid-map" class="section level2 unnumbered">
<h2>Recreating the COVID Map</h2>
<p>Now that we’ve explained the basics of geospatial data, let’s make a map. All those concepts you just learned about geometry types, dimensions, bounding boxes, projections, and the <code>geometry</code> column will come into play as we return to the COVID-19 map that Abdoul Madjid made. Let’s walk through the code Madjid used to make his map. I’ve made some small modifications to the code in order to make the final map fit on the page, but what you’ll see below is nearly identical to the original code.</p>
<p>Let’s begin by loading few packages to create Madjid’s COVID-19 map. We’ll use the <code>tidyverse</code> for data importing, manipulation, and plotting (with ggplot). The <code>albersusa</code> package will give us the geospatial data we need and the <code>sf</code> package will enable us to change its coordinate reference system to use an appropriate projection. The <code>zoo</code> package has functions for calculating rolling averages and the <code>colorspace</code> package gives us a color scale that highlights the data well.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(albersusa)</span>
<span id="cb4-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb4-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb4-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span></code></pre></div>
</div>
<div id="importing-our-data" class="section level2 unnumbered">
<h2>Importing Our Data</h2>
<p>Next, let’s import the data we need. There are three pieces of data we’ll import:</p>
<ol style="list-style-type: decimal">
<li>COVID rates by state over time</li>
<li>State populations</li>
<li>Geospatial data to make our map of the United States</li>
</ol>
<p>Madjid imported each of these pieces of data separately and then merged them, and we’ll do the same.</p>
<p>First, we import COVID data. This data comes directly from the <em>New York Times</em>, which publishes daily case rates by state as a CSV file on their GitHub account. I’ve dropped the <code>fips</code> variable (FIPS, which stands for Federal Information Processing Standards, are numeric codes used to represent states) because we can just use the state name instead.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a>covid_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fips)</span></code></pre></div>
<p>If we take a look at this data we can see the arrival of the first COVID cases in the United States in January 2020.</p>
<pre><code>#&gt; # A tibble: 56,006 × 4
#&gt;    date       state      cases deaths
#&gt;    &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 2020-01-21 Washington     1      0
#&gt;  2 2020-01-22 Washington     1      0
#&gt;  3 2020-01-23 Washington     1      0
#&gt;  4 2020-01-24 Illinois       1      0
#&gt;  5 2020-01-24 Washington     1      0
#&gt;  6 2020-01-25 California     1      0
#&gt;  7 2020-01-25 Illinois       1      0
#&gt;  8 2020-01-25 Washington     1      0
#&gt;  9 2020-01-26 Arizona        1      0
#&gt; 10 2020-01-26 California     2      0
#&gt; # … with 55,996 more rows</code></pre>
<p>The map that Abdoul Madjid made shows not absolute rates, but per capita rates. So, to recreate his maps, we need to have data on population by state. Madjid downloaded this data as a CSV. The code below imports this data, keeps the <code>State</code> and <code>Pop</code> (population) variables, and saves it as an object called <code>usa_states</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a>usa_states <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/population-by-state.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State, Pop)</span></code></pre></div>
<p>Let’s see what <code>usa_states</code> looks like.</p>
<pre><code>#&gt; # A tibble: 52 × 2
#&gt;    State               Pop
#&gt;    &lt;chr&gt;             &lt;dbl&gt;
#&gt;  1 California     39613493
#&gt;  2 Texas          29730311
#&gt;  3 Florida        21944577
#&gt;  4 New York       19299981
#&gt;  5 Pennsylvania   12804123
#&gt;  6 Illinois       12569321
#&gt;  7 Ohio           11714618
#&gt;  8 Georgia        10830007
#&gt;  9 North Carolina 10701022
#&gt; 10 Michigan        9992427
#&gt; # … with 42 more rows</code></pre>
<p>Finally, we’ll bring in our geospatial data and save it as an object called <code>usa_states_geom</code>. The <code>usa_sf()</code> function from the <code>albersausa</code> package gives us simple features data for all U.S. states (and, conveniently, puts Alaska and Hawaii in a location and at a scale that they are easy to see). This data includes multiple variables, but we only need the state name so we only keep the <code>name</code> variable.</p>
<p>Madjid then used the <code>st_transform()</code> function from the <code>sf</code> package to change the coordinate reference system. The CRS that he used comes from the <code>us_laea_proj</code> object, which comes from the <code>alberusa</code> package. Remember the Albers equal-area conic convenience projection we used to change the appearance of our Wyoming counties map? This is the same projection. Here’s the full code to import <code>usa_states_geom</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb9-1" aria-hidden="true" tabindex="-1"></a>usa_states_geom <span class="ot">&lt;-</span> <span class="fu">usa_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(us_laea_proj)</span></code></pre></div>
<div id="a-short-detour-to-discuss-projections" class="section level3 unnumbered">
<h3>A Short Detour to Discuss Projections</h3>
<p>Let’s pause for a moment to plot our geospatial data. As we saw when making our maps of Wyoming, it only takes three lines to make a map from our simple features data.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb10-1" aria-hidden="true" tabindex="-1"></a>usa_states_geom <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p>In Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:us-map-albers-projection">5.11</a>, we can see the curvature of the longitude and latitude lines and see how the land curves along with them.</p>
<div class="figure"><span style="display:block;" id="fig:us-map-albers-projection"></span>
<img src="maps_files/figure-html/us-map-albers-projection-1.png" alt="A map of the United States using the Albers equal-area conic convenience projection" width="100%" />
<p class="caption">
Figure 5.11: A map of the United States using the Albers equal-area conic convenience projection
</p>
</div>
<p>If we want to see the same data projected with a different coordinate reference system, we can import the data again using the <code>usa_sf()</code> function, but without setting the CRS to the Albers equal-area conic convenience projection. I’m also only keeping the <code>name</code> variable in order to make our output easier to read.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb11-1" aria-hidden="true" tabindex="-1"></a>usa_states_wgs84 <span class="ot">&lt;-</span> <span class="fu">usa_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name)</span></code></pre></div>
<p>I saved this object as <code>usa_states_wgs84</code> because, as you can see below, the <code>usa_sf()</code> function returns data that uses the WGS84 projection. Here’s what it looks like.</p>
<pre><code>#&gt; Simple feature collection with 51 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -124.7332 ymin: 20.63151 xmax: -66.9499 ymax: 49.38436
#&gt; Geodetic CRS:  WGS 84
#&gt; First 10 features:
#&gt;                    name                       geometry
#&gt; 1               Arizona MULTIPOLYGON (((-112.5386 3...
#&gt; 2              Arkansas MULTIPOLYGON (((-94.04296 3...
#&gt; 3            California MULTIPOLYGON (((-120.2485 3...
#&gt; 4              Colorado MULTIPOLYGON (((-107.3178 4...
#&gt; 5           Connecticut MULTIPOLYGON (((-72.39743 4...
#&gt; 6  District of Columbia MULTIPOLYGON (((-77.03299 3...
#&gt; 7               Georgia MULTIPOLYGON (((-84.81048 3...
#&gt; 8              Illinois MULTIPOLYGON (((-89.36603 4...
#&gt; 9               Indiana MULTIPOLYGON (((-84.80412 4...
#&gt; 10            Louisiana MULTIPOLYGON (((-88.86507 2...</code></pre>
<p>We can now use the same three lines of code (switching out <code>usa_states_geom</code> for <code>usa_states_wgs84</code>) to plot our map.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb13-1" aria-hidden="true" tabindex="-1"></a>usa_states_wgs84 <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p>If we take a look at the resulting map in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:us-map-wgs84-projection">5.12</a> below, we can see how different it looks. The curvature of the latitude and longitude lines is gone and the shape of the United States has changed as well, looking far more straight than our previous map.</p>
<div class="figure"><span style="display:block;" id="fig:us-map-wgs84-projection"></span>
<img src="maps_files/figure-html/us-map-wgs84-projection-1.png" alt="A map of the United States using the WGS84 projection" width="100%" />
<p class="caption">
Figure 5.12: A map of the United States using the WGS84 projection
</p>
</div>
<p>There are many, many different projections you can use. The conclusion of this chapter talks about how to select appropriate projections when making your own maps.</p>
</div>
</div>
<div id="calculating-daily-covid-cases" class="section level2 unnumbered">
<h2>Calculating Daily COVID Cases</h2>
<p>Next, we need to calculate the number of daily COVID cases. We have to do this because the <code>covid_data</code> data frame gives us cumulative cases by state. So, to calculate the number of cases per day for each state, Madjid grouped the data by state using the <code>group_by()</code> function, then created a new variable called <code>pd_cases</code>, which represents the number of cases in the previous day (he uses the <code>lag()</code> function to create this variable). Some days do not have cases counts for the previous day so, in these cases, Madjid set the value as 0 using the <code>replace_na()</code> function. Finally, Madjid created a new variable called <code>daily_cases</code>. For this variable, he used the <code>case_when()</code> function to set up a condition: if the <code>cases</code> variable (cases on that day) is greater than the <code>pd_cases</code> variable (cases one day prior), then <code>daily_cases</code> is equal to <code>cases</code> minus <code>pd_cases</code>; otherwise, set <code>daily_cases</code> to be equal to 0. Since we grouped the data by state at the beginning, we must now remove this grouping using the <code>ungroup()</code> function.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-1" aria-hidden="true" tabindex="-1"></a>covid_cases <span class="ot">&lt;-</span> covid_data <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pd_cases =</span> <span class="fu">lag</span>(cases)</span>
<span id="cb14-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">pd_cases =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-8"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">daily_cases =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-9"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-9" aria-hidden="true" tabindex="-1"></a>      cases <span class="sc">&gt;</span> pd_cases <span class="sc">~</span> cases <span class="sc">-</span> pd_cases,</span>
<span id="cb14-10"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb14-11"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-12"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-14"><a href="the-briefest-of-primers-on-geospatial-data.html#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state, date)</span></code></pre></div>
<p>We can now take a look at the <code>covid_cases</code> data frame we created. The variable we care about for the next step is <code>daily_cases</code>.</p>
<pre><code>#&gt; # A tibble: 56,006 × 6
#&gt;    date       state   cases deaths pd_cases daily_cases
#&gt;    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
#&gt;  1 2020-03-13 Alabama     6      0        0           6
#&gt;  2 2020-03-14 Alabama    12      0        6           6
#&gt;  3 2020-03-15 Alabama    23      0       12          11
#&gt;  4 2020-03-16 Alabama    29      0       23           6
#&gt;  5 2020-03-17 Alabama    39      0       29          10
#&gt;  6 2020-03-18 Alabama    51      0       39          12
#&gt;  7 2020-03-19 Alabama    78      0       51          27
#&gt;  8 2020-03-20 Alabama   106      0       78          28
#&gt;  9 2020-03-21 Alabama   131      0      106          25
#&gt; 10 2020-03-22 Alabama   157      0      131          26
#&gt; # … with 55,996 more rows</code></pre>
</div>
<div id="calculating-incidence-rates" class="section level2 unnumbered">
<h2>Calculating Incidence Rates</h2>
<p>We’re not quite done calculating values. The data that Madjid used to make his map was not daily case counts. Instead, it was a five-day rolling average of cases per 100,000 people. Madjid created a new data frame called <code>covid_cases_rm</code> (rm for rolling mean). The first step in its creation is to use the <code>rollmean()</code> function from the <code>zoo</code> package to create a <code>roll_cases</code> variable. The <code>k</code> argument is the number of days (five in order to calculate the five-day rolling average) and the <code>fill</code> argument determines what happens in cases like the first day where we can’t calculate a five-day rolling mean because there are no days prior to this day (Madjid set these values to be NA). Here is that section of the code:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb16-1" aria-hidden="true" tabindex="-1"></a>covid_cases <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">roll_cases =</span> <span class="fu">rollmean</span>(</span>
<span id="cb16-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb16-3" aria-hidden="true" tabindex="-1"></a>    daily_cases,</span>
<span id="cb16-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> <span class="dv">5</span>,</span>
<span id="cb16-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb16-6"><a href="the-briefest-of-primers-on-geospatial-data.html#cb16-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p>After calculating <code>roll_cases</code>, Madjid started work on calculating per capita case rates. To do this, he needed population data so he joined the population data from the <code>usa_states</code> data frame with the <code>covid_cases</code> data. He then dropped rows with missing population data (the <code>Pop</code> variable). In practice, this meant getting rid of several U.S. territories (American Samoa, Guam, Northern Marianas Islands, and Virgin Islands).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(usa_states,</span>
<span id="cb17-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb17-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span> <span class="ot">=</span> <span class="st">&quot;State&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(Pop)</span></code></pre></div>
<p>Next, Madjid created a per capita case rate variable called <code>incidence_rate</code> by multiplying the <code>roll_cases</code> variable by 100,000 and then dividing it by the population of each state. Rather than keeping raw values (for example, the Florida on June 29, 2021 had a rate of 57.77737 cases per 100,000 people), Madjid used the <code>cut()</code> function to convert the values into categories. His code in this section makes values of “&gt;0” (greater than 0), “&gt;5”, and so on up to a maximum value of “&gt;50”.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">incidence_rate =</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span> <span class="sc">*</span> roll_cases <span class="sc">/</span> Pop) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">incidence_rate =</span> <span class="fu">cut</span>(incidence_rate,</span>
<span id="cb18-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb18-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">5</span>), <span class="cn">Inf</span>),</span>
<span id="cb18-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb18-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">include.lowest =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb18-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">&quot;&gt;&quot;</span>, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">5</span>))))</span></code></pre></div>
<p>The last step is to filter to only include 2021 data because Madjid’s map only shows that year and select only the variables (<code>state</code>, <code>date</code>, and <code>incidence_rate</code>) we’ll need to create our map. The full code to create the <code>covid_cases_rm</code> data frame is below.</p>
<p>Let’s now take a look at the <code>covid_cases_rm</code> data frame.</p>
<pre><code>#&gt; # A tibble: 18,980 × 3
#&gt;    state   date       incidence_rate
#&gt;    &lt;chr&gt;   &lt;date&gt;     &lt;fct&gt;         
#&gt;  1 Alabama 2021-01-01 &gt;50           
#&gt;  2 Alabama 2021-01-02 &gt;50           
#&gt;  3 Alabama 2021-01-03 &gt;50           
#&gt;  4 Alabama 2021-01-04 &gt;50           
#&gt;  5 Alabama 2021-01-05 &gt;50           
#&gt;  6 Alabama 2021-01-06 &gt;50           
#&gt;  7 Alabama 2021-01-07 &gt;50           
#&gt;  8 Alabama 2021-01-08 &gt;50           
#&gt;  9 Alabama 2021-01-09 &gt;50           
#&gt; 10 Alabama 2021-01-10 &gt;50           
#&gt; # … with 18,970 more rows</code></pre>
</div>
<div id="adding-geospatial-data" class="section level2 unnumbered">
<h2>Adding Geospatial Data</h2>
<p>We’ve now used two (COVID case data and state population data) of our three data sources to create the <code>covid_cases_rm</code> data frame that we’ll use to make our map. Let’s use our third data source: the geospatial data we saved as <code>usa_states_geom</code>. We start with this data frame and then merge our <code>covid_cases_rm</code> data frame into it, matching the <code>name</code> variable from <code>usa_states_geom</code> to the <code>state</code> variable in <code>covid_cases_rm</code>. Being able to merge together regular data frames with geospatial data is possible with simple features data, another mark in its favor.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb20-1" aria-hidden="true" tabindex="-1"></a>usa_states_geom <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(covid_cases_rm, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;state&quot;</span>))</span></code></pre></div>
<p>Next, Madjid created a new variable called <code>fancy_date</code>. As the name implies, it’s a nicely formatted version of the date so that we get “Jan. 01” instead of “2021-01-01.” The <code>format()</code> function does the formatting while the <code>fct_inorder()</code> function makes it so that the <code>fancy_date()</code> variable will display in order by date (rather than, say, putting August before January because it comes first alphabetically). Last, we use the <code>relocate()</code> function to put the <code>fancy_date</code> column next to the <code>date</code> column. We save this data frame as <code>usa_states_geom_covid</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb21-1" aria-hidden="true" tabindex="-1"></a>usa_states_geom_covid <span class="ot">&lt;-</span> usa_states_geom <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(covid_cases_rm, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;state&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fancy_date =</span> <span class="fu">fct_inorder</span>(<span class="fu">format</span>(date, <span class="st">&quot;%b. %d&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(fancy_date, <span class="at">.before =</span> incidence_rate)</span></code></pre></div>
<p>If we take a look at the <code>usa_states_geom_covid</code> data frame, we can see the metadata and <code>geometry</code> columns discussed above.</p>
<pre><code>#&gt; Simple feature collection with 18615 features and 4 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -2100000 ymin: -2500000 xmax: 2516374 ymax: 732103.3
#&gt; CRS:           +proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs
#&gt; First 10 features:
#&gt;       name       date fancy_date incidence_rate
#&gt; 1  Arizona 2021-01-01    Jan. 01            &gt;50
#&gt; 2  Arizona 2021-01-02    Jan. 02            &gt;50
#&gt; 3  Arizona 2021-01-03    Jan. 03            &gt;50
#&gt; 4  Arizona 2021-01-04    Jan. 04            &gt;50
#&gt; 5  Arizona 2021-01-05    Jan. 05            &gt;50
#&gt; 6  Arizona 2021-01-06    Jan. 06            &gt;50
#&gt; 7  Arizona 2021-01-07    Jan. 07            &gt;50
#&gt; 8  Arizona 2021-01-08    Jan. 08            &gt;50
#&gt; 9  Arizona 2021-01-09    Jan. 09            &gt;50
#&gt; 10 Arizona 2021-01-10    Jan. 10            &gt;50
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-1111066 -8...
#&gt; 2  MULTIPOLYGON (((-1111066 -8...
#&gt; 3  MULTIPOLYGON (((-1111066 -8...
#&gt; 4  MULTIPOLYGON (((-1111066 -8...
#&gt; 5  MULTIPOLYGON (((-1111066 -8...
#&gt; 6  MULTIPOLYGON (((-1111066 -8...
#&gt; 7  MULTIPOLYGON (((-1111066 -8...
#&gt; 8  MULTIPOLYGON (((-1111066 -8...
#&gt; 9  MULTIPOLYGON (((-1111066 -8...
#&gt; 10 MULTIPOLYGON (((-1111066 -8...</code></pre>
</div>
<div id="making-the-map" class="section level2 unnumbered">
<h2>Making the Map</h2>
<p>It was a lot of work to end up with the surprisingly simple data frame <code>usa_states_geom_covid</code>, but it’s all we need in order to make our map. The data may be simple, but the code that Abdoul Madjid used to make his map is quite complex. Let’s look at it in pieces.</p>
<p>But before doing so, two quick notes:</p>
<p>First: The final map is actually multiple maps, one for each day in 2021. Combining 365 days makes for a large final product. So, instead of showing every day for each step, I’m going to filter the <code>usa_states_geom_covid</code> to just show the first six days in January. I do this using the code below and save the result as a data frame called <code>usa_states_geom_covid_six_days</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb23-1" aria-hidden="true" tabindex="-1"></a>usa_states_geom_covid_six_days <span class="ot">&lt;-</span> usa_states_geom_covid <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2021-01-06&quot;</span>))</span></code></pre></div>
<p>Here’s what this data looks like:</p>
<pre><code>#&gt; Simple feature collection with 306 features and 4 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -2100000 ymin: -2500000 xmax: 2516374 ymax: 732103.3
#&gt; CRS:           +proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs
#&gt; First 10 features:
#&gt;        name       date fancy_date incidence_rate
#&gt; 1   Arizona 2021-01-01    Jan. 01            &gt;50
#&gt; 2   Arizona 2021-01-02    Jan. 02            &gt;50
#&gt; 3   Arizona 2021-01-03    Jan. 03            &gt;50
#&gt; 4   Arizona 2021-01-04    Jan. 04            &gt;50
#&gt; 5   Arizona 2021-01-05    Jan. 05            &gt;50
#&gt; 6   Arizona 2021-01-06    Jan. 06            &gt;50
#&gt; 7  Arkansas 2021-01-01    Jan. 01            &gt;50
#&gt; 8  Arkansas 2021-01-02    Jan. 02            &gt;50
#&gt; 9  Arkansas 2021-01-03    Jan. 03            &gt;50
#&gt; 10 Arkansas 2021-01-04    Jan. 04            &gt;50
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((-1111066 -8...
#&gt; 2  MULTIPOLYGON (((-1111066 -8...
#&gt; 3  MULTIPOLYGON (((-1111066 -8...
#&gt; 4  MULTIPOLYGON (((-1111066 -8...
#&gt; 5  MULTIPOLYGON (((-1111066 -8...
#&gt; 6  MULTIPOLYGON (((-1111066 -8...
#&gt; 7  MULTIPOLYGON (((557903.1 -1...
#&gt; 8  MULTIPOLYGON (((557903.1 -1...
#&gt; 9  MULTIPOLYGON (((557903.1 -1...
#&gt; 10 MULTIPOLYGON (((557903.1 -1...</code></pre>
<p>Second: the final product that Abdoul Madjid made is giant in order to fit all 365 days. I’ve had to change sizes of a few elements below to make them fit in this book. I’ve kept the overall structure of the code, but changed a few specific elements (for example, making text sizes smaller) so that everything fits.</p>
<div id="generating-the-basic-map" class="section level3 unnumbered">
<h3>Generating the Basic Map</h3>
<p>Now that we have six days of data, let’s make some maps. Abdoul Madjid’s map-making code has three main parts:</p>
<ol style="list-style-type: decimal">
<li>Making the basic map</li>
<li>Changing colors</li>
<li>Making tweaks to the theme</li>
</ol>
<p>The three lines of code that we used above to make our Wyoming maps come back again, with some adornments to improve the quality of our map. Below, we can see that we’re using <code>geom_sf()</code> to plot our geospatial data. Madjid modified a couple arguments, using <code>size = .05</code> to make the state borders less prominent and <code>color = "grey55"</code> to make the borders a medium grey color. Then, because he made one map for each day, he used the <code>facet_wrap()</code> function. The <code>vars(fancy_date)</code> code specifies that the <code>fancy_date</code> variable should be used to do the faceting (in other words, make one map for each day) and <code>strip.position = "bottom"</code> moves the labels “Jan. 01”, “Jan. 02”, and so on to the bottom of the maps.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-1" aria-hidden="true" tabindex="-1"></a>usa_states_geom_covid_six_days <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb25-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> incidence_rate),</span>
<span id="cb25-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">05</span>,</span>
<span id="cb25-6"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;grey55&quot;</span></span>
<span id="cb25-7"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-8"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb25-9"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(fancy_date),</span>
<span id="cb25-10"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb25-11"><a href="the-briefest-of-primers-on-geospatial-data.html#cb25-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>The resulting map can be seen in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:basic-map">5.13</a>.</p>
<div class="figure"><span style="display:block;" id="fig:basic-map"></span>
<img src="maps_files/figure-html/basic-map-1.png" alt="A map showing the incidence rate of COVID for the first six days of 2021" width="100%" />
<p class="caption">
Figure 5.13: A map showing the incidence rate of COVID for the first six days of 2021
</p>
</div>
</div>
<div id="changing-colors-and-beginning-to-tweak-the-legend" class="section level3" number="5.0.1">
<h3><span class="header-section-number">5.0.1</span> Changing Colors and Beginning to Tweak the Legend</h3>
<p>Next, Madjid tweaked the colors of his maps. He used the <code>scale_fill_discrete_sequential()</code> function from the <code>colorspace</code> package to set the color scale. This function is quite similar to the <code>scale_fill_viridis_d()</code> function that Cédric Scherer and Georgios Karamanis used to make their drought data visualization in Chapter <a href="data-viz-chapter.html#data-viz-chapter">3</a>. Both visualizations use the “rocket” palette, with the fill scale going from a tan at the low end to a black at the high end. Madjid then used the <code>name</code> argument to set the title for the legend. By default, it would use the variable name (<code>incidence_rate</code>), but Madjid improves it by using “COVID-19 INCIDENCE RATE” instead.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-1" aria-hidden="true" tabindex="-1"></a>usa_states_geom_covid_six_days <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb26-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> incidence_rate),</span>
<span id="cb26-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">05</span>,</span>
<span id="cb26-6"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;grey55&quot;</span></span>
<span id="cb26-7"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-8"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb26-9"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(fancy_date),</span>
<span id="cb26-10"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb26-11"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-12"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete_sequential</span>(</span>
<span id="cb26-13"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">&quot;Rocket&quot;</span>,</span>
<span id="cb26-14"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;COVID-19 INCIDENCE RATE&quot;</span></span>
<span id="cb26-15"><a href="the-briefest-of-primers-on-geospatial-data.html#cb26-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Our in-progress map can be seen in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:map-with-rocket-palette">5.14</a> below.</p>
<div class="figure"><span style="display:block;" id="fig:map-with-rocket-palette"></span>
<img src="maps_files/figure-html/map-with-rocket-palette-1.png" alt="The COVID map with the rocket palette added" width="100%" />
<p class="caption">
Figure 5.14: The COVID map with the rocket palette added
</p>
</div>
<p>I’ve actually only shown a portion of the code that Abdoul Madjid used within the <code>scale_fill_discrete_sequential()</code> function. He also used the <code>guide</code> argument and the <code>guide_legend()</code> function to make tweaks to the legend. His code does the following:</p>
<ul>
<li>Puts the colored squares in one row (<code>nrow = 1</code>) rather than the default (all in a single column)</li>
<li>Sets the height and width of each colored square (.3 centimeters for each)</li>
<li>Sets the font family, size, and margin of both the labels (the “&gt;0,” “&gt;5,” and so on) with <code>label.theme</code> and the title (“COVID-19 INCIDENCE RATE”) with <code>title.theme</code></li>
<li>Puts the title on top of the legend (<code>title.position = "top"</code>) and centers it (<code>title.hjust = .5</code>)</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-1" aria-hidden="true" tabindex="-1"></a>usa_states_geom_covid_six_days <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb27-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> incidence_rate),</span>
<span id="cb27-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">05</span>,</span>
<span id="cb27-6"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span></span>
<span id="cb27-7"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-8"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb27-9"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(fancy_date),</span>
<span id="cb27-10"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">&quot;bottom&quot;</span></span>
<span id="cb27-11"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-12"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete_sequential</span>(</span>
<span id="cb27-13"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">&quot;Rocket&quot;</span>,</span>
<span id="cb27-14"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;COVID-19 INCIDENCE RATE&quot;</span>,</span>
<span id="cb27-15"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb27-16"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb27-17"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">keyheight =</span> <span class="fu">unit</span>(.<span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb27-18"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">keywidth =</span> <span class="fu">unit</span>(.<span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb27-19"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">label.theme =</span> <span class="fu">element_text</span>(</span>
<span id="cb27-20"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> <span class="st">&quot;Times New Roman&quot;</span>,</span>
<span id="cb27-21"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">6</span>),</span>
<span id="cb27-22"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">margin =</span> <span class="fu">margin</span>(</span>
<span id="cb27-23"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">r =</span> <span class="dv">5</span>,</span>
<span id="cb27-24"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">unit =</span> <span class="st">&quot;pt&quot;</span></span>
<span id="cb27-25"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-26"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-26" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb27-27"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">title.theme =</span> <span class="fu">element_text</span>(</span>
<span id="cb27-28"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> <span class="st">&quot;Times New Roman&quot;</span>,</span>
<span id="cb27-29"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">9</span>),</span>
<span id="cb27-30"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">margin =</span> <span class="fu">margin</span>(</span>
<span id="cb27-31"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">b =</span> .<span class="dv">1</span>,</span>
<span id="cb27-32"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span></span>
<span id="cb27-33"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-33" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-34"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-34" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb27-35"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb27-36"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">title.hjust =</span> .<span class="dv">5</span></span>
<span id="cb27-37"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-38"><a href="the-briefest-of-primers-on-geospatial-data.html#cb27-38" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>If we view our map at this point, it won’t actually look like much because the legend is currently quite large in relation to the maps. In order to change this, and to make some other tweaks to improve the look-and-feel of our maps, Madjid made multiple tweaks to the maps themselves. He did this using the <code>theme()</code> function from the <code>ggplot2</code> package. One benefit of making maps with ggplot is that all of the tweaks you use when making a regular plot can be carried over to your maps as well. Many of the tweaks within the <code>theme()</code> function below are similar to those seen in Chapter <a href="data-viz-chapter.html#data-viz-chapter">3</a>. I’m saving the map as it is now as the object <code>map_with_legend_tweaks</code> so that we can add onto it below.</p>
</div>
<div id="tweaking-the-theme-the-legend" class="section level3" number="5.0.2">
<h3><span class="header-section-number">5.0.2</span> Tweaking the Theme: The Legend</h3>
<p>Let’s review the changes that Abdoul Madjid made to his maps using ggplot themes. He began by applying <code>theme_minimal()</code> to his map. This removes the ugly gray background that ggplot applies to plots (and maps). He then applied additional tweaks using the <code>theme()</code> function. Let’s start by looking at the tweaks to the legend.</p>
<p>While the code in the <code>scale_fill_discrete_sequential()</code> function customized individual elements <em>within</em> the legend (for example, the size of the colored squares), the code below customizes the legend as a whole. Madjid moved the legend to the top of the maps using <code>legend.position = "top"</code> and added a bit of spacing around the legend with <code>legend.box.spacing = unit(.25, "cm")</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb28-1" aria-hidden="true" tabindex="-1"></a>map_with_legend_tweaks <span class="sc">+</span></span>
<span id="cb28-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb28-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb28-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.spacing =</span> <span class="fu">unit</span>(.<span class="dv">25</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb28-6"><a href="the-briefest-of-primers-on-geospatial-data.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We can see the result of these tweaks in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:map-with-more-legend-tweaks">5.15</a> below.</p>
<div class="figure"><span style="display:block;" id="fig:map-with-more-legend-tweaks"></span>
<img src="maps_files/figure-html/map-with-more-legend-tweaks-1.png" alt="The COVID map with additional tweaks to the legend" width="100%" />
<p class="caption">
Figure 5.15: The COVID map with additional tweaks to the legend
</p>
</div>
<p>As I did above, I’m saving the map as it is at this point (in this case, to an object called <code>map_with_more_legend_tweaks</code>) to avoid having to reprint all of the code for each map (I do the same thing in the sections below).</p>
</div>
<div id="tweaking-the-theme-the-title-caption-and-strip-text" class="section level3" number="5.0.3">
<h3><span class="header-section-number">5.0.3</span> Tweaking the Theme: The Title, Caption, and Strip Text</h3>
<p>Next, Madjid made tweaks to the title and caption. Below, we added the title and caption using this <code>labs()</code> function. Then, we see how Madjid used the <code>theme()</code> function to tweak these elements as well as the label for each map (“Jan. 01”, “Jan. 02”, and so on). He makes all text use Times New Roman and makes it a nearly black color using the hex code #111111. This sets defaults for all text elements, but Madjid also made tweaks to individual elements as well. He set the size of the title to be 2.5 times that of other text elements (<code>size = rel(2.5)</code>), made it bold (<code>face = "bold"</code>) and centered (<code>hjust = 0.5</code>), and added 0.25 centimeter margins on the top and bottom (<code>hjust = 0.5, margin = margin(t = .25, b = .25, unit = "cm")</code>). He made the same tweaks to the caption, with the exception of adjusting the font size. And finally, Abdoul Madjid adjusted the size and bolding of the individual map labels using <code>strip.text</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-1" aria-hidden="true" tabindex="-1"></a>map_with_more_legend_tweaks <span class="sc">+</span></span>
<span id="cb29-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;2021 · A pandemic year&quot;</span>,</span>
<span id="cb29-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Incidence rates are calculated for 100,000 people in each state.</span></span>
<span id="cb29-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="st">                  Inspired from a graphic in the DIE ZEIT newspaper of November 18, 2021.</span></span>
<span id="cb29-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="st">                  Data from NY Times · Tidytuesday Week-1 2022 · Abdoul ISSA BIDA.&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-7"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;Times New Roman&quot;</span>, </span>
<span id="cb29-8"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color =</span> <span class="st">&quot;#111111&quot;</span>),</span>
<span id="cb29-9"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb29-10"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">2.5</span>),</span>
<span id="cb29-11"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="cb29-12"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb29-13"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> .<span class="dv">25</span>, </span>
<span id="cb29-14"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">b =</span> .<span class="dv">25</span>, </span>
<span id="cb29-15"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb29-16"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-16" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-17"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(</span>
<span id="cb29-18"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb29-19"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>,</span>
<span id="cb29-20"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> .<span class="dv">25</span>, </span>
<span id="cb29-21"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">b =</span> .<span class="dv">25</span>, </span>
<span id="cb29-22"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>)),</span>
<span id="cb29-23"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.75</span>), </span>
<span id="cb29-24"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-24" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)</span>
<span id="cb29-25"><a href="the-briefest-of-primers-on-geospatial-data.html#cb29-25" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>The resulting map shows up in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:map-with-text-tweaks">5.16</a> below.</p>
<div class="figure"><span style="display:block;" id="fig:map-with-text-tweaks"></span>
<img src="maps_files/figure-html/map-with-text-tweaks-1.png" alt="The COVID map with tweaks to the title, captions, and strip text" width="100%" />
<p class="caption">
Figure 5.16: The COVID map with tweaks to the title, captions, and strip text
</p>
</div>
</div>
<div id="tweaking-the-theme-grid-lines-and-axis-text" class="section level3" number="5.0.4">
<h3><span class="header-section-number">5.0.4</span> Tweaking the Theme: Grid Lines and Axis Text</h3>
<p>Our map is looking good! Just a few tweaks left to get it close to Abdoul Madjid’s original. By default, maps made with the <code>geom_sf()</code> function have axis text and lines to show longitude and latitude. Madjid removed them using the <code>element_blank()</code> function on <code>panel.grid</code> and <code>axis.text</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb30-1" aria-hidden="true" tabindex="-1"></a>map_with_text_tweaks <span class="sc">+</span></span>
<span id="cb30-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb30-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>The result, seen in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:map-with-grid-tweaks">5.17</a>, is a much nicer-looking set of maps.</p>
<div class="figure"><span style="display:block;" id="fig:map-with-grid-tweaks"></span>
<img src="maps_files/figure-html/map-with-grid-tweaks-1.png" alt="The COVID map without the grid lines and axis text" width="100%" />
<p class="caption">
Figure 5.17: The COVID map without the grid lines and axis text
</p>
</div>
</div>
<div id="tweaking-the-theme-plot-background-and-margins" class="section level3" number="5.0.5">
<h3><span class="header-section-number">5.0.5</span> Tweaking the Theme: Plot Background and Margins</h3>
<p>The last bit of tweaking that Abdoul Madjid did was to adjust the margins around the final set of maps and give the whole thing a light gray background. The former is done within <code>plot.margin</code> while the latter is done using <code>plot.background</code>. Setting the fill color of #e5e4e2 gives it that light gray background while the <code>color = NA</code> ensures there is no outline around the plot (without that code, it would have a black border).</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-1" aria-hidden="true" tabindex="-1"></a>map_with_grid_and_axis_tweaks <span class="sc">+</span></span>
<span id="cb31-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> .<span class="dv">25</span>, </span>
<span id="cb31-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">r =</span> .<span class="dv">25</span>, </span>
<span id="cb31-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">b =</span> .<span class="dv">25</span>, </span>
<span id="cb31-6"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">l =</span> .<span class="dv">25</span>, </span>
<span id="cb31-7"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">unit =</span> <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb31-8"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#e5e4e2&quot;</span>, </span>
<span id="cb31-9"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> <span class="cn">NA</span>)</span>
<span id="cb31-10"><a href="the-briefest-of-primers-on-geospatial-data.html#cb31-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>And there we have it: Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:map-with-background-tweaks">5.18</a> our recreation of Abdoul Madjid’s COVID-19 map.</p>
<div class="figure"><span style="display:block;" id="fig:map-with-background-tweaks"></span>
<img src="maps_files/figure-html/map-with-background-tweaks-1.png" alt="The COVID map with tweaks to the margins and the background color" width="100%" />
<p class="caption">
Figure 5.18: The COVID map with tweaks to the margins and the background color
</p>
</div>
</div>
</div>
<div id="in-conclusion-r-is-a-map-making-swiss-army-knife" class="section level2 unnumbered">
<h2>In Conclusion: R is a Map-Making Swiss Army Knife</h2>
<p>If this chapter has inspired you to want to make your own maps in R, fantastic! As we’ve seen from Abdoul Madjid’s work, you can use R both to gather and analyze geospatial data as well make maps it. R is a map-making Swiss army knife.</p>
<p>In the first part of this chapter, I gave you a quick overview of how geospatial data works. You may now be wondering: okay, great, but how do I actually make my own maps? Let’s talk about where you can find geospatial data.</p>
<div id="finding-geospatial-data" class="section level3 unnumbered">
<h3>Finding Geospatial Data</h3>
<p>First, a reminder: we’re exclusively discussing vector data in the simple features format. While there are other types of geospatial data, simple features data is the easiest to get started with.</p>
<p>With that said, there are two ways to access geospatial data. The first is to import raw data. Geospatial data can take a number of different formats. While ESRL shapefiles (with the .shp extension) are the most common, there is also GeoJSON (.geojson), KML (.kml), and others (chapter 8 of <em>Geocomputation with R</em> by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow discusses the range of formats). The good news for us is that there is a single function that can read in pretty much any type of geospatial data. That function is <code>read_sf()</code> from the <code>sf</code> package. Let’s show an example of how it works.</p>
<p>I downloaded geospatial data from the website geojson.xyz on United States state boundaries in GeoJSON format, saving it in the <code>data</code> folder as states.geojson. I can then import this data using the <code>read_sf()</code> function. I use the <code>dsn</code> argument (dsn stands for data source name) to tell <code>read_sf()</code> where to find the file. I then save this as the object <code>us_states</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb32-1" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="at">dsn =</span> <span class="st">&quot;data/states.geojson&quot;</span>)</span></code></pre></div>
<p>Let’s now take at <code>us_states</code>. The data has 41 variables so, to keep things legible, let’s just keep a couple: <code>name</code> (of the state) and <code>geometry</code>. I can show these two by selecting only <code>name</code> because, when working with simple features data, the <code>geometry</code> column is unaffected by operations to all other variables. We can see all of the metadata we discussed above (geometry type, dimensions, bounding box, and coordinate reference system) as well as the data itself.</p>
<pre><code>#&gt; Simple feature collection with 51 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -171.7911 ymin: 18.91619 xmax: -66.96466 ymax: 71.35776
#&gt; Geodetic CRS:  WGS 84
#&gt; # A tibble: 51 × 2
#&gt;    name                                             geometry
#&gt;    &lt;chr&gt;                                  &lt;MULTIPOLYGON [°]&gt;
#&gt;  1 Minnesota    (((-89.59941 48.01027, -89.48888 48.01344, …
#&gt;  2 Montana      (((-111.1942 44.56116, -111.2915 44.70141, …
#&gt;  3 North Dakota (((-96.60136 46.35136, -96.53891 46.19948, …
#&gt;  4 Hawaii       (((-155.9366 19.05939, -155.9081 19.33888, …
#&gt;  5 Idaho        (((-111.0497 44.48816, -111.0502 42.0016, -…
#&gt;  6 Washington   (((-116.9981 46.33017, -116.9065 46.17778, …
#&gt;  7 Arizona      (((-109.0452 36.99991, -109.0437 31.3419, -…
#&gt;  8 California   (((-114.3549 34.46467, -114.166 34.27259, -…
#&gt;  9 Colorado     (((-102.0502 40.00081, -102.0401 38.45987, …
#&gt; 10 Nevada       (((-114.0305 36.9941, -114.0236 36.18976, -…
#&gt; # … with 41 more rows</code></pre>
<p>To prove that this is geospatial data like that we’ve seen throughout this chapter, let’s make a map with it. I’ll use the same three lines we’ve used throughout this chapter.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb34-1" aria-hidden="true" tabindex="-1"></a>us_states <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() </span></code></pre></div>
<p>And there we have it: Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:geojson-us-map">5.19</a> shows a map of all 50 states.</p>
<div class="figure"><span style="display:block;" id="fig:geojson-us-map"></span>
<img src="maps_files/figure-html/geojson-us-map-1.png" alt="A map of the United States made with GeoJSON data" width="100%" />
<p class="caption">
Figure 5.19: A map of the United States made with GeoJSON data
</p>
</div>
<p>Working with raw geosaptial data in this way is sometimes necessary. But not always. That’s because there are R packages that provide functions to access geospatial data. Abdoul Madjid used the <code>usa_sf()</code> function from the <code>albersusa</code> package to bring in his geospatial data. Another package for accessing geospatial data related to the United States is called <code>tigris</code>. This package has a number of well-named functions for bringing in different types of data. One of these is the <code>states()</code> function. We can load the <code>tigris</code> package and run the <code>states()</code> function. Let’s use the <code>cb = TRUE</code> argument to not use the most detailed shapefile and set the resolution to a more manageable “20m” (without these changes, the shapefile we’d get would be large and slow to work with). We also set <code>progress_bar = FALSE</code> in order to not see messages that <code>tigris</code> shares while it loads data. We then save the result as <code>states_tigris</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb35-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb35-3" aria-hidden="true" tabindex="-1"></a>states_tigris <span class="ot">&lt;-</span> <span class="fu">states</span>(<span class="at">cb =</span> <span class="cn">TRUE</span>, </span>
<span id="cb35-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb35-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">resolution =</span> <span class="st">&quot;20m&quot;</span>,</span>
<span id="cb35-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb35-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">progress_bar =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The <code>states_tigris</code> object has 14 variables, but let’s just keep the <code>NAME</code> and <code>geometry</code> variables in order to make the output easier to read. Our output has 52 rows (referred to in the output as features): the 50 states as well as the District of Columbia and Puerto Rico.</p>
<pre><code>#&gt; Simple feature collection with 52 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -179.1743 ymin: 17.91377 xmax: 179.7739 ymax: 71.35256
#&gt; Geodetic CRS:  NAD83
#&gt; First 10 features:
#&gt;                    NAME                       geometry
#&gt; 1             Tennessee MULTIPOLYGON (((-90.3007 35...
#&gt; 2             Minnesota MULTIPOLYGON (((-97.22904 4...
#&gt; 3              Illinois MULTIPOLYGON (((-91.50626 4...
#&gt; 4               Montana MULTIPOLYGON (((-116.0492 4...
#&gt; 5  District of Columbia MULTIPOLYGON (((-77.11976 3...
#&gt; 6            California MULTIPOLYGON (((-118.594 33...
#&gt; 7              Kentucky MULTIPOLYGON (((-89.54443 3...
#&gt; 8              Delaware MULTIPOLYGON (((-75.77379 3...
#&gt; 9                 Texas MULTIPOLYGON (((-106.6234 3...
#&gt; 10            Wisconsin MULTIPOLYGON (((-86.93428 4...</code></pre>
<p>We can plot this as well, but before doing so, I’m going to use the <code>shift_geometry()</code> function from <code>tigris</code>. This will put Alaska, Hawaii, and Puerto Rico in places that it is easier to see all states. It also resizes these three states to make them easier to see on a map alongside the continental United States. This is similar to what the <code>usa_sf()</code> function from <code>albersusa</code> did above.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb37-1" aria-hidden="true" tabindex="-1"></a>states_tigris <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shift_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb37-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p>The map, using data and the <code>shift_geometry</code> function from the <code>tigris</code> package are seen in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:tigris-us-map">5.20</a> below.</p>
<div class="figure"><span style="display:block;" id="fig:tigris-us-map"></span>
<img src="maps_files/figure-html/tigris-us-map-1.png" alt="A map of the United States made with data from the tigris package" width="100%" />
<p class="caption">
Figure 5.20: A map of the United States made with data from the tigris package
</p>
</div>
<p>The <code>tigris</code> package has functions to get geospatial data on counties, census tracts, roads, and more. Kyle Walker, developer of the package, has also written an entire book, titled <em>Analyzing US Census Data: Methods, Maps, and Models in R</em>, that is a great place to learn more about how to use it.</p>
<p>If you’re looking for data outside of the United States, fear not! The <code>rnaturalearth</code> package provides functions to import geospatial data from across the world. This package has a number of functions, but let’s look at one: <code>ne_countries()</code>. This function gets geospatial data on countries throughout the world. I’m using two arguments in the code below: <code>returnclass = "sf"</code> to get data in simple features format and <code>continent = "Africa"</code> to only get some countries. I save the result to an object called <code>africa_countries</code>.</p>
<p>We can see our data below (as above, I’m keeping only the country name and the <code>geometry</code> column for legibility).</p>
<pre><code>#&gt; Simple feature collection with 51 features and 1 field
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -17.62504 ymin: -34.81917 xmax: 51.13387 ymax: 37.34999
#&gt; CRS:           +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0
#&gt; First 10 features:
#&gt;                    name                       geometry
#&gt; 1                Angola MULTIPOLYGON (((16.32653 -5...
#&gt; 11              Burundi MULTIPOLYGON (((29.34 -4.49...
#&gt; 13                Benin MULTIPOLYGON (((2.691702 6....
#&gt; 14         Burkina Faso MULTIPOLYGON (((-2.827496 9...
#&gt; 25             Botswana MULTIPOLYGON (((25.64916 -1...
#&gt; 26 Central African Rep. MULTIPOLYGON (((15.27946 7....
#&gt; 31        Côte d&#39;Ivoire MULTIPOLYGON (((-2.856125 4...
#&gt; 32             Cameroon MULTIPOLYGON (((13.07582 2....
#&gt; 33      Dem. Rep. Congo MULTIPOLYGON (((30.83386 3....
#&gt; 34                Congo MULTIPOLYGON (((12.99552 -4...</code></pre>
<p>And we can plot our data on a map with the same three lines as always.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb39-1" aria-hidden="true" tabindex="-1"></a>africa_countries <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p>The resulting map shows up in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:africa-map">5.21</a>.</p>
<div class="figure"><span style="display:block;" id="fig:africa-map"></span>
<img src="maps_files/figure-html/africa-map-1.png" alt="A map of Africa made with data from the rnaturalearth package" width="100%" />
<p class="caption">
Figure 5.21: A map of Africa made with data from the rnaturalearth package
</p>
</div>
<p>If you need geospatial data, start by looking for a package like <code>albersusa</code>, <code>tigris</code>, or <code>rnaturalearth</code>. If you can’t find a package to access geospatial data, you can always fall back on using <code>read_sf()</code> from the <code>sf</code> package. No matter what, there is a way to get your geospatial data into R!</p>
</div>
<div id="using-appropriate-projections" class="section level3 unnumbered">
<h3>Using Appropriate Projections</h3>
<p>Once you have access to geospatial data and are ready to map it, you need to think about which projection to use. If you’re looking for a simple answer to this question, you’re going to be disappointed. As Robin Lovelace, Jakub Nowosad, and Jannes Muenchow put it in their book <em>Geocomputation with R</em>, “the question of <em>which</em> CRS [to use] is tricky, and there is rarely a ‘right’ answer.”</p>
<p>If you feel overwhelmed with choosing a projection, there is a package to help. The <code>crsuggest</code> package, also made by Kyle Walker, can give you ideas for a projection to use. The <code>suggest_top_crs()</code> function will return a CRS that is well-suited for your data. Let’s load <code>crsuggest</code> and try it out on our <code>africa_countries</code> data.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crsuggest)</span>
<span id="cb40-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb40-3" aria-hidden="true" tabindex="-1"></a>africa_countries <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suggest_top_crs</span>()</span></code></pre></div>
<p>The <code>suggest_top_crs</code> function returns the projection number 28232. We can now use this value in combination with the <code>st_transform</code> function in order to change the projection before we plot.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb41-1" aria-hidden="true" tabindex="-1"></a>africa_countries <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">28232</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p>When we run this code, we see in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:africa-map-different-projection">5.22</a> below, Africa mapped with a different projection.</p>
<div class="figure"><span style="display:block;" id="fig:africa-map-different-projection"></span>
<img src="maps_files/figure-html/africa-map-different-projection-1.png" alt="A map of Africa made with projection number 28232" width="100%" />
<p class="caption">
Figure 5.22: A map of Africa made with projection number 28232
</p>
</div>
</div>
<div id="bring-your-existing-r-skills-to-geospatial-data" class="section level3 unnumbered">
<h3>Bring Your Existing R Skills to Geospatial Data</h3>
<p>Abdoul Madjid’s process for analyzing data involved a few steps: he began by doing analysis on traditional data frames (recall the data on COVID rates and that on state populations). Once he had done his analysis on these data frames, he merged them with his geospatial data to create the <code>usa_states_geom_covid</code> data frame that he used to make his map. The ability to merge traditional data frames with geospatial data is a huge benefit of working with simple features data.</p>
<p>Simple features data, as we’ve seen, looks almost exactly like a traditional data frame with two differences: 1) metadata and 2) a <code>geometry</code> column. And here’s the thing with simple features data: it acts just like a traditional data frame, too. While Madjid did all of his analysis in traditional data frames before merging them with simple features data, you can also work directly on your geospatial data. All of the basic data wrangling and analysis functions from the <code>tidyverse</code> work on a simple features object.</p>
<p>To demonstrate this, let’s return to the <code>africa_countries</code> simple features data. Let’s select two variables (<code>name</code> and <code>pop_est</code>) to see the name and population of the countries.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb42-1" aria-hidden="true" tabindex="-1"></a>africa_countries <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, pop_est)</span></code></pre></div>
<p>The output we get is this:</p>
<pre><code>#&gt; Simple feature collection with 51 features and 2 fields
#&gt; Geometry type: MULTIPOLYGON
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: -17.62504 ymin: -34.81917 xmax: 51.13387 ymax: 37.34999
#&gt; CRS:           +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0
#&gt; First 10 features:
#&gt;                    name  pop_est
#&gt; 1                Angola 12799293
#&gt; 11              Burundi  8988091
#&gt; 13                Benin  8791832
#&gt; 14         Burkina Faso 15746232
#&gt; 25             Botswana  1990876
#&gt; 26 Central African Rep.  4511488
#&gt; 31        Côte d&#39;Ivoire 20617068
#&gt; 32             Cameroon 18879301
#&gt; 33      Dem. Rep. Congo 68692542
#&gt; 34                Congo  4012809
#&gt;                          geometry
#&gt; 1  MULTIPOLYGON (((16.32653 -5...
#&gt; 11 MULTIPOLYGON (((29.34 -4.49...
#&gt; 13 MULTIPOLYGON (((2.691702 6....
#&gt; 14 MULTIPOLYGON (((-2.827496 9...
#&gt; 25 MULTIPOLYGON (((25.64916 -1...
#&gt; 26 MULTIPOLYGON (((15.27946 7....
#&gt; 31 MULTIPOLYGON (((-2.856125 4...
#&gt; 32 MULTIPOLYGON (((13.07582 2....
#&gt; 33 MULTIPOLYGON (((30.83386 3....
#&gt; 34 MULTIPOLYGON (((12.99552 -4...</code></pre>
<p>Let’s now work with these two variables. What if I want to make a map that shows which African countries have populations over 20 million? To do so, I’d need a variable that calculates whether each country has a population over 20 million. I can do this using <code>mutate()</code> and the <code>if_else()</code> functions, creating a new variable called <code>population_above_20_million</code> that is TRUE if a country’s population is over 20 million and FALSE otherwise.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb44-1" aria-hidden="true" tabindex="-1"></a>africa_countries <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, pop_est) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population_above_20_million =</span> <span class="fu">if_else</span>(pop_est <span class="sc">&gt;</span> <span class="dv">20000000</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span></code></pre></div>
<p>We can then take this code and pipe it into ggplot, setting the <code>fill</code> aesthetic property to be equal to <code>population_above_20_million</code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="the-briefest-of-primers-on-geospatial-data.html#cb45-1" aria-hidden="true" tabindex="-1"></a>africa_countries <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="the-briefest-of-primers-on-geospatial-data.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, pop_est) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="the-briefest-of-primers-on-geospatial-data.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population_above_20_million =</span> <span class="fu">if_else</span>(pop_est <span class="sc">&gt;</span> <span class="dv">20000000</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="the-briefest-of-primers-on-geospatial-data.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> population_above_20_million)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="the-briefest-of-primers-on-geospatial-data.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p>And we end up with the map in Figure <a href="the-briefest-of-primers-on-geospatial-data.html#fig:africa-map-20m">5.23</a>.</p>
<div class="figure"><span style="display:block;" id="fig:africa-map-20m"></span>
<img src="maps_files/figure-html/africa-map-20m-1.png" alt="A map of Africa that highlights countries with populations above 20 million people" width="100%" />
<p class="caption">
Figure 5.23: A map of Africa that highlights countries with populations above 20 million people
</p>
</div>
<p>This is a simple example of the type of data wrangling and analysis you can do on simple features data. The larger lesson is this: all of the skills you’ve worked hard to develop to work with data in R will also serve you well when working with geospatial data.</p>
</div>
<div id="why-r-is-best-tool-for-making-maps" class="section level3 unnumbered">
<h3>Why R is Best Tool for Making Maps</h3>
<p>This chapter has been a short, if exhausting, romp through the world of map-making in R. We’ve discussed the basics needed to understand geospatial data, seen how Abdoul Madjid applied this knowledge and principles of high-quality data visualization to make his map, learned how to get your own geospatial data, and how to project it appropriately to make your own maps.</p>
<p>Over the years, I’ve come to believe that R is not just any old tool for making maps, but the best tool for making maps. It’s way more flexible than Excel, way less expensive than ArcGIS, and doesn’t require you to learn another tool like QGIS. But R as a map-making tool isn’t just good for these reasons. It’s good because you can use the general skills you’ve developed working with traditional data frames to your work with geospatial data. And the same ggplot code that makes your graphs shine will also help you make maps look great.</p>
<p>That’s what Abdoul Madjid did when making his map of COVID in the United States in 2021. Madjid is not a GIS expert, and that’s kind of the point. He combined an understanding of the basics of geospatial data, fundamental R skills, and knowledge of data visualization principles to make a beautiful map. Now it’s your turn to do the same.</p>

</div>
</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R Without Statistics</strong>" was written by David Keyes. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


</body>

</html>
