```{r}
i <- 1
chapter_number <- 10
source("_common.R")
```

# Quarto, the Next-Generation Tool for Reproducible Reporting {#quarto-chapter}

Quarto, the next-generation version of R Markdown, offers a few advantages over R Markdown. First, the syntax it uses across output types is more consistent. As you’ve seen in this book, R Markdown documents might use a variety of conventions; for example, the `distill` package has layout options that don’t work in `xaringan`, and `xaringan` uses three dashes to indicate new slides, while three dashes in other output formats would create a horizontal line. 

Quarto also supports more languages than does R Markdown, as well as multiple code editors. While R Markdown is designed to work in the RStudio IDE, Quarto works in RStudio as well as code editors such as VS Code and JupyterLab, making it easy to use with multiple languages.

This chapter focuses on the benefits of using Quarto as an R user. It explains how to set up Quarto, then covers some of the most important differences between Quarto and R Markdown. Lastly, you’ll learn how to make the parameterized reports, presentations, and websites covered in previous chapters using Quarto. 


## Creating a Quarto Document {-}

Versions of RStudio starting with 2022.07.1 come with Quarto installed. To check your RStudio version, click **RStudio** in the top menu bar, then click **About RStudio**. If you have an older version of RStudio, update it now by reinstalling it, as outlined in Chapter \@ref(howto-chapter). Quarto should then be installed for you.

Once you’ve installed Quarto, create a document by clicking **File** > **New File** > **Quarto Document**. You should see a menu, shown in Figure \@ref(fig:new-quarto-doc), that looks like the one used to create an R Markdown document.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r new-quarto-doc, out.width="100%", fig.cap="The RStudio menu for creating a new Quarto document"}
knitr::include_graphics(here::here("assets/new-quarto-doc.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/new-quarto-doc.png"))
```

Give your document a title and choose an output format. The *Engine* option allows you to select a different way to render documents. By default, it uses Knitr, the same rendering tool used by R Markdown. The *Use visual markdown editor* option provides an interface that looks more like Microsoft Word, but it can be finicky, so we won’t cover it here. 

The resulting Quarto document should contain default content, as do R Markdown documents:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
---
title: "My Report"
format: html
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
1 + 1
```

You can add options to executable code like this 

```{r}
#| echo: false
2 * 2
```

The `echo: false` option disables the printing of code (only output is displayed).
````

Although R Markdown and Quarto have many things in common, they also have differences. Let’s explore them.

## Comparing R Markdown and Quarto {-}

Quarto and R Markdown documents have the same basic structure: YAML metadata, followed by a combination of Markdown text and code chunks. Despite the similarities between the formats, there are some variations in their syntax. 

### The format and execute YAML Fields {-}

Quarto uses slightly different options in its YAML. It replaces the `output` field with the `format` field and uses the value html instead of `html_document`:

```
---
title: "My Report"
output: html_document
---
```

Other Quarto formats also use slightly different names than their R Markdown counterparts: `docx` instead of `word_document` and `pdf` instead of `pdf_document`, for example.

A second difference between R Markdown and Quarto is that Quarto doesn’t use a `setup` code chunk to set default options about things like whether to show code, charts, and other elements in the rendered versions of the document. In Quarto, these options are set in the `execute` field of the YAML. For example, the following would hide code, as well as all warnings and messages, from the rendered document: 

```
---
title: "My Report"
format: html
execute:
  echo: false
  warning: false
  message: false
---
```

Quarto also allows you to write true and false in lower case.

### Individual Code Chunk Options {-}

In R Markdown, we override options at the individual code chunk level by adding the new option within the curly brackets that start a code chunk. For example, the following would show both the code `2 * 2` as well as its output:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
```{r echo = TRUE}
2 * 2
```
````

Quarto instead uses the following syntax to set individual code chunk-level options: 
````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
```{r}
#| echo: false
2 * 2
```
````

You can see that the option is set within the code chunk itself. The characters `#|` (known as the *hash pipe*) at the start of a line indicate that we are setting options.

### Dashes in Option Names {-}

Another difference you’re likely to see if you switch from R Markdown to Quarto is that option names consisting of two words are separated by a dash rather than a period. R Markdown, for example, uses the code chunk option `fig.height` to determine the height of plots. In contrast, Quarto uses `fig-height`, as follows:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
```{r}
#| fig-height: 10

library(palmerpenguins)
library(tidyverse)

ggplot(penguins, aes(x = bill_length_mm,
                     y = bill_depth_mm)) +
  geom_point()
```
````

Helpfully for those of us coming from R Markdown, `fig.height` and similar options with periods in them will continue to work if you forget to make the switch. A list of all code chunk options can be found on the Quarto website at https://quarto.org/docs/reference/cells/cells-knitr.html.

### The Render Button {-}

You can follow the same process to render your Quarto document as in R Markdown, but in Quarto the button is called Render rather than Knit. Figure \@ref(fig:render-button) shows the Render button.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r render-button, out.width="100%", fig.cap="The Render button"}
knitr::include_graphics(here::here("assets/render-button.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/render-button.png"))
```

Clicking the Render button will turn the Quarto document into an HTML file, Word document, or any other output format you select, just as we did when working with R Markdown.

## Parameterized Reporting {-}

Now that you’ve learned how Quarto works, let’s make a few different documents with it, starting with a parameterized report. The process of making parameterized reports with Quarto is nearly identical to doing so with R Markdown. In fact, you can take the R Markdown document used to make the Urban Institute COVID Report in Chapter \@ref(parameterized-reporting-chapter) and adapt it for Quarto by copying the *.Rmd* file and changing its extension to *.qmd*, then making a few changes:


````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
---
title: "Urban Institute COVID Report"
format: html
params:
  state: "Alabama"
execute:
  echo: false
  warning: false
  message: false
---

```{r}
library(tidyverse)
library(urbnthemes)
library(here)
library(scales)
```

# `r params$state`

```{r}
cases <- tibble(state.name) %>%
  rbind(state.name = "District of Columbia") %>%
  left_join(read_csv("https://data.rwithoutstatistics.com/united_states_covid19_cases_deaths_and_testing_by_state.csv", skip = 2),
            by = c("state.name" = "State/Territory")) %>%
  select(total_cases = `Total Cases`, state.name,
         cases_per_100000 = `Case Rate per 100000`) %>%
  mutate(cases_per_100000 = parse_number(cases_per_100000)) %>% 
  mutate(case_rank = rank(-cases_per_100000, ties.method = "min"))
```

```{r}
state_text <- if_else(params$state == "District of Columbia", str_glue("the District of Columbia"), str_glue("state of {params$state}"))

state_cases_per_100000 <- cases %>%
  filter(state.name == params$state) %>% 
  pull(cases_per_100000) %>% 
  comma()

state_cases_rank <- cases %>%
  filter(state.name == params$state) %>% 
  pull(case_rank)
```

In `r state_text`, there were `r state_cases_per_100000` cases per 100,000 people in the last seven days. This puts `r params$state` at number `r state_cases_rank` of 50 states and the District of Columbia. 

```{r}
#| fig-height: 8

set_urbn_defaults(style = "print")

cases %>% 
  mutate(highlight_state = if_else(state.name == params$state, "Y", "N")) %>% 
  mutate(state.name = fct_reorder(state.name, cases_per_100000)) %>% 
  ggplot(aes(x = cases_per_100000,
             y = state.name,
             fill = highlight_state)) +
  geom_col() +
  scale_x_continuous(labels = comma_format()) +
  theme(legend.position = "none") +
  labs(y = NULL,
       x = "Cases per 100,000")
```
````

In this code, we’ve switched `output: html_document` to `format: html` in the YAML, We’ve also removed the `setup` code chunk and put the options that were there in the YAML. Lastly, we’ve switched the `fig.height` option in the last code chunk to `fig-height` and used the hash pipe to label it as an option.

Next, to create one report for each state, we must tweak the render.R script file we used to make parameterized reports in Chapter \@ref(parameterized-reporting-chapter):

````{verbatim echo = TRUE, eval = FALSE, lang = "r"}
# Load packages
library(tidyverse)
library(quarto)

# Create a vector of all states and the District of Columbia
state <- tibble(state.name) %>%
  rbind("District of Columbia") %>% 
  pull(state.name)

# Create a tibble with information on the:
# input R Markdown document
# output HTML file
# parameters needed to knit the document
reports <- tibble(
  input = "urban-covid-budget-report.qmd",
  output_file = str_glue("{state}.html"),
  execute_params = map(state, ~list(state = .))
)

# Generate all of our reports
reports %>%
  pwalk(quarto_render)
````

This updated *render.R* file loads the quarto package instead of the `rmarkdown` package and changes the input file to *urban-covid-budget-report.qmd*. In the `reports` tibble, we use `execute_params` instead of `params` because this is the argument that the `quarto_render()` function expects. To render the reports, we use the `quarto_render()` function instead of the `render()` function from the markdown package. As in Chapter \@ref(parameterized-reporting-chapter), running this code should produce one report for each state.

### Making Presentations {-}

Quarto can produce presentations like those you made in Chapter \@ref(presentations-chapter) with the xaringan package. To make a presentation with Quarto, click **File** > **New File** > **Quarto Presentation**. Choose Reveal JS to make your slides and leave the Engine and Editor options untouched, as shown in Figure \@ref(fig:quarto-new-presentation).

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-new-presentation, out.width="100%", fig.cap="The RStudio menu to make a new Quarto presentation"}
knitr::include_graphics(here::here("assets/quarto-new-presentation.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-new-presentation.png"))
```

The slides we’ll make use the `reveal.js` JavaScript library under the hood, a technique similar to making slides with `xaringan`. The following code updates the presentation made in Chapter \@ref(presentations-chapter) so it works with Quarto:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
---
title: "Penguins Report"
author: "David Keyes"
format: revealjs
execute: 
  echo: false
  warning: false
  message: false
---

# Introduction

```{r}
library(tidyverse)
```

```{r}
penguins <- read_csv("https://raw.githubusercontent.com/rfortherestofus/r-without-statistics/main/data/penguins-2008.csv")
```

We are writing a report about the **Palmer Penguins**. These penguins are *really* amazing. There are three species:

- Adelie
- Gentoo
- Chinstrap

## Bill Length

We can make a histogram to see the distribution of bill lengths.

```{r}
penguins %>% 
  ggplot(aes(x = bill_length_mm)) +
  geom_histogram() +
  theme_minimal()
```

```{r}
average_bill_length <- penguins %>% 
  summarize(avg_bill_length = mean(bill_length_mm,
                                   na.rm = TRUE)) %>% 
  pull(avg_bill_length)
```

The chart shows the distribution of bill lengths. The average bill length is `r average_bill_length` millimeters.
````

In the YAML, we set `format: revealjs` to make a presentation and add several global code chunk options in the `execute` section. We remove the three dashes used to make slide breaks, because in Quarto, first- or second-level headings make new slides (though you can use three dashes to manually add slide breaks). When you render this code, you should get an HTML file with your slides. The output should look similar to the default `xaringan` slides we made. 

#### Incrementally Revealing Content {-}

Quarto slides can incrementally reveal content. To reveal bulleted and numbered lists one item at a time by default, add `incremental: true` to the document’s YAML:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
---
title: "Penguins Report"
author: "David Keyes"
format: 
  revealjs:
	  incremental: true
execute: 
  echo: false
  warning: false
  message: false
---
````

As a result, the content in all lists in the presentation should appear on the slide one item at a time. You can also set just some lists to incrementally reveal using this format:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
::: {.incremental}
- Adelie
- Gentoo
- Chinstrap
:::
````

Using `:::` to start and end a segment of the document creates a section in the resulting HTML file known as a `<div>`. The HTML `<div>` tag allows you to define properties within that section. In this code, adding `{.incremental}` sets a custom CSS class that makes the list reveal incrementally.

#### Aligning Content and Adding Background Images {-}

We can use a <div> to create columns in Quarto slides, too. Let’s say we want to create a slide with content in two columns, as in Figure \@ref(fig:quarto-slides-two-columns).

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-slides-two-columns, out.width="100%", fig.cap="A slide with two columns"}
knitr::include_graphics(here::here("assets/quarto-slides-two-columns.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-slides-two-columns.png"))
```

The following code created this two-column slide: 

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
:::: {.columns}

::: {.column width="50%"}
```{r}
penguins %>% 
  ggplot(aes(x = bill_length_mm)) +
  geom_histogram() +
  theme_minimal()
```

:::

::: {.column width="50%"}
```{r}
penguins %>% 
  ggplot(aes(x = bill_depth_mm)) +
  geom_histogram() +
  theme_minimal()
```

:::

::::
````

Notice the `:::`, as well as `::::`, which creates nested `<div>` sections. We first use a `columns` class, which tells the HTML that all content within the `::::` should be laid out as columns. Then, we use `::: {.column width="50%"}` to start a `<div>` that takes up half the width of the slide. With use closing `::::` and `:::` to indicate the end of the section.

When using `xaringan`, we easily centered content on a slide by surrounding it with `.center[]`. Doing the same thing in Quarto is slightly more complicated. Quarto has no built-in CSS class to center content, so we need to create one ourselves. Begin a CSS code chunk and a custom class called `center-slide`: 

````{verbatim echo = TRUE, eval = FALSE, lang = "css"}
```{css}
.center-slide {
	text-align: center;
}
```
````

Using CSS, we center-align all content. (The `text-align` property aligns images, too, not just text.) We then apply the new `center-slide` class by putting it next to the title of the slide, as follows:

````{verbatim echo = TRUE, eval = FALSE, lang = "css"}
## Bill Length {.center-slide}
````

With the custom CSS applied, the slide should now center all content.

Lastly, when working in `xaringan`, we added a background image to a slide. We can do the same thing in Quarto by applying the `background-image` attribute to a slide, as follows:

````{verbatim echo = TRUE, eval = FALSE, lang = "css"}
## Penguins {background-image="penguins.jpg"}
````

This should add a slide with the text *Penguins* in front of the selected image.

#### Customizing Your Slides with Themes and CSS {-}

We've started making some changes to the look-and-feel of our Quarto slides. The sky is the limit in terms of further customizations. As with `xaringan`, there are two main ways to customize your slides: 

1. Using existing themes
2. Changing the CSS

Themes are the easiest way to change what your slides look like. Quarto has many themes you can apply by adding their name to your YAML as follows:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
---
title: "Penguins Report"
format:
  revealjs: 
    theme: dark
---
````

Using this theme will change from the default light theme to a dark theme. The title slide with the dark theme applied can be seen in Figure \@ref(fig:quarto-slide-dark).

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-slide-dark, out.width="100%", fig.cap="A slide with the dark theme applied"}
knitr::include_graphics(here::here("assets/quarto-slide-dark.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-slide-dark.png"))
```

To see the full list of available themes, go to https://quarto.org/docs/presentations/revealjs/themes.html.

You can also write custom CSS to change your slides further. Quarto uses a type of CSS called Sass. The most important practical implication  of using Sass is that we can use variables in our CSS. There are a number of variables that we can target to make changes to our slides. If you recall how the `xaringanthemer` package allowed us to target things like `header_h2_font_size` and `header_color`, using pre-existing variables with Sass will feel very similar. 

To start, I'll create a Sass file called `theme.scss` and add two sections to it as follows:

````{verbatim echo = TRUE, eval = FALSE, lang = "css"}
/*-- scss:defaults --*/

/*-- scss:rules --*/
````

In the `scss:defaults` section, we can use the Quarto Sass variables. For example, to change the color and size of first-level headers, I would add this code:

````{verbatim echo = TRUE, eval = FALSE, lang = "css"}
/*-- scss:defaults --*/
$presentation-heading-color: red;
$presentation-h1-font-size: 150px;

/*-- scss:rules --*/
````

To apply these tweaks to my slides, I need to adjust my YAML to tell Quarto use my custom `theme.scss` file. I do this as follows:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
---
title: "Penguins Reports"
format:
  revealjs: 
    theme: theme.scss
---
````

Figure \@ref(fig:quarto-slide-scss) shows the changes applied to my rendered slides.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-slide-scss, out.width="100%", fig.cap="A slide with custom CSS applied to it"}
knitr::include_graphics(here::here("assets/quarto-slide-scss.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-slide-scss.png"))
```

The `scss:defaults` section is for using available variables (the full list of variables is available at https://quarto.org/docs/presentations/revealjs/themes.html#sass-variables). The `sass:rules` section is where you would add additional tweaks that can't be done by targeting variables. For example, I could take my code from above to center all of the content in a slide and add it to the `scss:defaults` section. 

````{verbatim echo = TRUE, eval = FALSE, lang = "css"}
/*-- scss:defaults --*/
$presentation-heading-color: red;
$presentation-h1-font-size: 150px;

/*-- scss:rules --*/
.center-slide {
  text-align: center;
}
````

Because rendered Quarto slides are HTML documents, you can tweak them however you'd like with custom CSS. What's more, because our slides use reveal.js under the hood, all of the features built into that Javascript library work in Quarto. There are easy ways to add transitions, animations, interactive content, and much more. The demo Quarto presentation, available at https://quarto.org/docs/presentations/revealjs/demo/, shows many of these features in action. 

### Making Websites with Quarto {-}

Quarto can also make websites. In the same way that we were able to make slides without an external package like `xaringan`, we can also make websites without an external package like `distill`. To create a Quarto website, go to File > New Project. Then select New Directory and you'll be presented with the menu in Figure \@ref(fig:new-project).

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r new-project, out.width="100%", fig.cap="The RStudio new project menu"}
knitr::include_graphics(here::here("assets/new-project.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/new-project.png"))
```

Select Quarto website and you'll be prompted to choose a directory to place it in. Keep the default Engine (Knitr), check Create a git repository (this will only show up if you have already installed git) and leave everything else unchecked. Your screen should look like Figure \@ref(fig:create-quarto-website).

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r create-quarto-website, out.width="100%", fig.cap="The RStudio menu to create a Quarto website"}
knitr::include_graphics(here::here("assets/create-quarto-website.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/create-quarto-website.png"))
```

Once you hit the Create Project button, you'll see a series of files created. There is an `index.qmd` and `about.qmd` file as well as a `_quarto.yml` and `styles.css` file. These files should sound familiar if you read Chapter \@ref(websites-chapter) on making websites with the `distill` package. The `.qmd ` files are where we'll add content; the `_quarto.yml` file is where we'll set options for the website as a whole; and the `styles.css` file is where we'll add CSS to customize the visual appearance of our website.

#### Building the Website {-}

Let's start with the `.qmd` files. Open `index.qmd` or `about.qmd` and you'll see some default content. I'm going to delete the default content from the `index.qmd` and replace it with the content from website we made in Chapter \@ref(websites-chapter). The only element I have removed is the `layout = "l-page"` that we used to make a wider layout for the map (we'll discuss how to make different layouts in Quarto below).

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
```{r}
# Load packages

library(tidyverse)
library(janitor)
library(tigris)
library(gt)
library(lubridate)
library(reactable)
```

```{r}
# Import data

us_states <- states(cb = TRUE, 
                    resolution = "20m",
                    progress_bar = FALSE) %>%
  shift_geometry() %>% 
  clean_names() %>% 
  select(geoid, name) %>% 
  rename(state = name) %>% 
  filter(state %in% state.name)

covid_data <- read_csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/rolling-averages/us-states.csv") %>% 
  filter(state %in% state.name) %>% 
  mutate(geoid = str_remove(geoid, "USA-")) 

most_recent_day <- covid_data %>% 
  slice_max(order_by = date,
            n = 1) %>% 
  distinct(date) %>% 
  mutate(date_nice_format = str_glue("{month(date, label = TRUE, abbr = FALSE)} {day(date)}, {year(date)}")) %>% 
  pull(date_nice_format)
```

# COVID Death Rates as of `r most_recent_day`

This table shows COVID death rates per 100,000 people in four states states.

```{r}
# Make table

covid_data %>% 
  slice_max(order_by = date,
            n = 1) %>%
  select(state, deaths_avg_per_100k) %>% 
  arrange(state) %>% 
  set_names("State", "Death rate") %>% 
  reactable()
```

We can see this same death rate data for all states on a map.

```{r}
# Make map

most_recent <- us_states %>% 
  left_join(covid_data, by = "state") %>% 
  slice_max(order_by = date,
            n = 1) 

most_recent %>% 
  ggplot(aes(fill = deaths_avg_per_100k)) +
  geom_sf() +
  scale_fill_viridis_c(option = "rocket") +
  labs(fill = "Deaths per\n100,000 people") +
  theme_void()
```

# COVID Death Rates Over Time

The following chart shows COVID death rates from the start of COVID in early 2020 until `r most_recent_day`.

```{r}
# Make chart

library(plotly)

covid_chart <- covid_data %>% 
  filter(state %in% c("Alabama",
                      "Alaska",
                      "Arizona",
                      "Arkansas")) %>% 
  ggplot(aes(x = date,
             y = deaths_avg_per_100k,
             group = state,
             fill = deaths_avg_per_100k)) +
  geom_col() +
  scale_fill_viridis_c(option = "rocket") +
  theme_minimal() +
  labs(title = "Deaths per 100,000 people over time") +
  theme(legend.position = "none",
        plot.title.position = "plot",
        plot.title = element_text(face = "bold"),
        panel.grid.minor = element_blank(),
        axis.title = element_blank()) +
  facet_wrap(~state,
             nrow = 2)


ggplotly(covid_chart)
```
````

At this point, I could render the `index.qmd` file individually, but I know I want to render the entire website so let's do that. You can build a Quarto website just as you did a `distill` website. Look for the Build tab in the top right of RStudio and click the button that says Render Website. Figure \@ref(fig:render-website-button) shows what you should see.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r render-website-button, out.width="100%", fig.cap="The render website button"}
knitr::include_graphics(here::here("assets/render-website-button.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/render-website-button.png"))
```

The rendered website should now appear in the Viewer pane on the bottom right panel of RStudio. If you go to the Files pane on the same panel you will also see that a `_site` folder has been created. If you go into this folder you will see all of the content in your rendered site. I'll open the `index.html` file in my web browser. You can see the website in Figure \@ref(fig:covid-website-messages).

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r covid-website-messages, out.width="100%", fig.cap="The Quarto website with warnings and messages"}
knitr::include_graphics(here::here("assets/covid-website-messages.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/covid-website-messages.png"))
```

As you can see, there are a lot of warnings and messages that we don't want to show. In R Markdown we removed these in our `setup` code chunk, but with Quarto we do it in the YAML. I could add this code to the `index.qmd` YAML, as we did when making a presentation, to remove all code, warnings, and messages from the output:

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
execute: 
  echo: false
  warning: false
  message: false
````

However, doing this will only make changes to that one file. Instead, we want to add them to the `_quarto.yml` file.

#### Setting Options for the Website {-}

With `distill` we used the `_site.yml` file to make changes to all files in our website. In With Quarto, we use the `_quarto.yml` file for the same purpose. If you open the `_quarto.yml` file, you should see three sections:

1. The top sets the project type (in this case, a website).
2. The middle section is where we set the title of the website as a whole and determine the options for our navigation bar. 
3. The bottom section deals with the appearance. 

````{verbatim echo = TRUE, eval = FALSE, lang = "yaml"}
project:
  type: website

website:
  title: "covid-website-quarto"
  navbar:
    left:
      - href: index.qmd
        text: Home
      - about.qmd

format:
  html:
    theme: cosmo
    css: styles.css
    toc: true
````

Let's start from the bottom. To remove code, warnings, and messages for all pages in our website, add the portion of the YAML we created above to the `_quarto.yml` file. The bottom section should now look like this:

````{verbatim echo = TRUE, eval = FALSE, lang = "yaml"}
format:
  html:
    theme: cosmo
    css: styles.css
    toc: true
execute: 
  echo: false
  warning: false
  message: false
````

If I now build the website again, I will see it, as in Figure \@ref(fig:covid-website-no-messages), with just the content I want to show. 

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r covid-website-no-messages, out.width="100%", fig.cap="The website with warnings and messages removed"}
knitr::include_graphics(here::here("assets/covid-website-no-messages.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/covid-website-no-messages.png"))
```

You can add any additional options that you would add to a single `.qmd` file to this section of the `_quarto.yml` file and it will apply them across all pages of your website. 

#### Changing the Appearance of the Website with Themes and CSS {-}

The other parts of the bottom section of the `_quarto.yml` file deal with the appearance of rendered files. The line `theme: cosmo` tells Quarto use the cosmo theme (the default when making websites). There are many themes available (the full list is available at https://quarto.org/docs/output-formats/html-themes.html) and I can choose a different one to show how it changes the output.

````{verbatim echo = TRUE, eval = FALSE, lang = "yaml"}
format:
  html:
    theme: minty
    css: styles.css
    toc: true
````

Using the minty theme results in changes to the colors and fonts on the website, as seen in Figure \@ref(fig:covid-website-minty).

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r covid-website-minty, out.width="100%", fig.cap="The website with the minty theme"}
knitr::include_graphics(here::here("assets/covid-website-minty.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/covid-website-minty.png"))
```

In addition to using pre-built themes, you can also customize your website with CSS. The `css: styles.css` section in the `_quarto.yml` file indicates that Quarto will use any CSS in the `styles.css` file when rendering. For example, I can add this to the `styles.css` to make first-level headers red and 50 pixels.

````{verbatim echo = TRUE, eval = FALSE, lang = "yaml"}
h1 {
	color: red;
  font-size: 50px;
}
````

The re-rendered `index.html`, seen in Figure \@ref(fig:covid-website-custom-css), shows the large red headings.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r covid-website-custom-css, out.width="100%", fig.cap="The website with custom CSS applied"}
knitr::include_graphics(here::here("assets/covid-website-custom-css.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/covid-website-custom-css.png"))
```

An alternative approach to customizing your website is to use Sass variables. The process for using Sass variables in a `.scss` file is identical to that laid out above. For example, I can create a file called `styles.scss` and add a line like this to change the body background to be a light gray color.

````{verbatim echo = TRUE, eval = FALSE, lang = "yaml"}
/*-- scss:defaults --*/
$body-bg: #eeeeee;
````

To get Quarto to use the `styles.scss` file, I adjust the `theme` line as follows. 

````{verbatim echo = TRUE, eval = FALSE, lang = "yaml"}
format:
  html:
		theme: [minty, styles.scss]
    css: styles.css
    toc: true
````

The syntax `theme: [minty, styles.scss]` tells Quarto to use the minty theme and then make any additional tweaks based on the `styles.scss` file. If I render my website again, I can see the light gray background throughout. Figure \@ref(fig:quarto-website-scss) shows the current version.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-website-scss, out.width="100%", fig.cap="The website with custom CSS applied through styles.scss"}
knitr::include_graphics(here::here("assets/quarto-website-scss.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-website-scss.png"))
```

Note that when you add a `.SCSS` file, the tweaks made in your CSS file are no longer applied. If you wanted to use those, you'd need to add them to the `styles.scss` file.

The line `toc: true` creates a table of contents on the side of rendered HTML files that you can see in the screenshots above. You can remove it by changing `true` to `false`, as seen in Figure \@ref(fig:quarto-website-no-toc) below. 

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-website-no-toc, out.width="100%", fig.cap="The website without the table of contents on pages"}
knitr::include_graphics(here::here("assets/quarto-website-no-toc.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-website-no-toc.png"))
```

This section of the `_quarto.yml` file is where you would add any additional options, such as figure height. 

#### Adjusting the Website Title and Navigation Bar {-}

The middle section of the `_quarto.yml` file deals with the title of the website as a whole as well as its navigation. I can change the title by adjusting that line. The `navbar` section functions nearly identically to how it did in Chapter \@ref(websites-chapter) when working with `distill`. The `href` is where you list the file you want to link to. The optional `text` line is where you manually specify the text that should show up for that link. Here are a couple changes to the default `_quarto.yml` to change the website title and the text for the About page link.

````{verbatim echo = TRUE, eval = FALSE, lang = "yaml"}
website:
  title: "Quarto COVID Website"
  navbar:
    left:
      - href: index.qmd
        text: Home
      - href: about.qmd
        text: About this Website
````

Figure \@ref(fig:quarto-website-navbar-changes) shows these changes applied to the website.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-website-navbar-changes, out.width="100%", fig.cap="The website with changes to the navigation bar"}
knitr::include_graphics(here::here("assets/quarto-website-navbar-changes.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-website-navbar-changes.png"))
```

The title on the home page is still covid-website-quarto, but you could change that in the `index.qmd` file.

Finally, we come to the top section of the `_quarto.yml`. This is the most straightforward. The line `type: website` indicates that the current project is a website (other project types include books, wikis, and more). 

#### Creating Wider Layouts {-}

When we made our website with `distill` we used `layout = "l-page"` to make the map wider. We can accomplish the same thing with Quarto, though the syntax is slightly different. With Quarto, you can adjust the width of the output using the `:::` syntax we saw above to add HTML `<div>` tags. To make the map larger on our Quarto website,  we add `:::{.column-screen-inset}` at the beginning and `:::` at the end of the code block that makes it. 

````{verbatim echo = TRUE, eval = FALSE, lang = "markdown"}
:::{.column-screen-inset}
```{r}
#| out-width: 100%
# Make map

most_recent <- us_states %>% 
  left_join(covid_data, by = "state") %>% 
  slice_max(order_by = date,
            n = 1) 

most_recent %>% 
  ggplot(aes(fill = deaths_avg_per_100k)) +
  geom_sf() +
  scale_fill_viridis_c(option = "rocket") +
  labs(fill = "Deaths per\n100,000 people") +
  theme_void()
```
:::
````

Figure \@ref(fig:quarto-website-wide-section) shows the wider map.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-website-wide-section, out.width="100%", fig.cap="The website with a wider section"}
knitr::include_graphics(here::here("assets/quarto-website-wide-section.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-website-wide-section.png"))
```

You may have noticed that I also added the line `#| out-width: 100%` in the code chunk. This is because we need to specify that the map should take up all of the available width. Without this line, the map would only take up a portion of the available width. There are a number of different output widths you can use (the full list is available at https://quarto.org/docs/authoring/article-layout.html).

#### Hosting Your Quarto Website {-}

After we finished making our `distill` website in Chapter \@ref(websites-chapter), we discussed hosting it using GitHub Pages. You can do the same thing with a Quarto website. Recall that GitHub Pages requires you to publish your website based on the files in the root of your repository or in the `docs` folder. I'll do the latter by changing my `_quarto.yml` file so that the site outputs in the `docs` folder. To do this, I add a line to the top section of the `_quarto.yml` file.

````{verbatim echo = TRUE, eval = FALSE, lang = "yaml"}
project:
  type: website
  output-dir: docs
````

Now, when I render my site, the HTML and other files show up in the `docs` directory. At this point, I can push my repository to GitHub, adjust the GitHub Pages settings as I did in Chapter \@ref(websites-chapter) and I will be given a URL where my Quarto website will live. 

In addition to using GitHub Pages, Quarto has a free service called Quarto Pub that makes it straightforward to get your materials online. Especially if you are not a GitHub user, this is a great option to publish your work. To show you how Quarto Pub works, let me publish the website we just made to it. To get started, look for the Terminal tab on the bottom left panel of RStudio. Click it and at the prompt enter the text `quarto publish` and hit enter. Doing so will bring up a list of ways you can publish your website. See Figure \@ref(fig:quarto-publish) below.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-publish, out.width="100%", fig.cap="The list of providers to publish your Quarto website"}
knitr::include_graphics(here::here("assets/quarto-publish.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-publish.png"))
```

Press enter to select Quarto Pub. You'll then be asked to authorize. Type Y to do so, which will take you to quartopub.com. Sign up for an account (or sign in if you already have one). You should see a screen like Figure \@ref(fig:quarto-pub-authorize), indicating that you have successfully signed in and authorized RStudio to connect with Quarto Pub.

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r TODO, out.width="100%", fig.cap="The confirmation screen from Quarto Pub"}
knitr::include_graphics(here::here("assets/quarto-pub-authorize.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-pub-authorize.png"))
```

From there, you can return to RStudio. You'll be prompted to select a name for your website on Quarto Pub. The easiest thing is to select the same name as your project (in my case, that's `quarto-website-covid`). Enter the name and hit enter. The site will then be published and you will be taken to the site, as seen in Figure \@ref(fig:quarto-pub-website).

```{r results='asis'}
print_nostarch_file_name(file_type_to_print = "png")
```

```{r quarto-pub-website, out.width="100%", fig.cap="The website published on Quarto Pub"}
knitr::include_graphics(here::here("assets/quarto-pub-website.png"))
```

```{r results='asis'}
save_image_for_nostarch(here::here("assets/quarto-pub-website.png"))
```

When you make updates to your site, you can republish to Quarto Pub using the same steps. Quarto Pub is probably the easiest way to publish your HTML files made with Quarto.

## Conclusion: Should You Use R Markdown or Quarto? {-}

As you've seen throughout this chapter, we can do everything we did with R Markdown in Quarto as well. And, unlike R Markdown, we didn't need to load any external packages to make different outputs. What's more, the syntax between different output formats is more consistent. For example, because you can make new slides in Quarto by adding first- or second-level headers, the Quarto documents you make to create reports should translate much more easily to presentations. 

You're probably wondering at this point whether you should use R Markdown or Quarto. It's a big question, and one many in the R community are thinking about. 

The first thing to know is that R Markdown is not going away. If you already use R Markdown, you don't need to switch. As of the writing of this book, I still use R Markdown for most of my work. If you have developed a workflow that uses R Markdown, by all means stick with it. 

If you are new to R and have never used R Markdown or Quarto, you may be a good candidate to start with Quarto. The developers of R Markdown have promised to continue its development, but have also said that features they develop for Quarto in the future may not be backported to R Markdown. So, if you're starting from scratch, start with Quarto.

My strongest recommendation, though, is to use either R Markdown or Quarto. As you've seen throughout this chapter, the differences between R Markdown and Quarto are relatively small and the impact on your workflow of switching should be minor. The major impact will come if you switch from a multi-tool workflow to a single tool workflow. Both R Markdown and Quarto can help you become more efficient, avoid manual errors, and share results in a wide variety of formats. 
